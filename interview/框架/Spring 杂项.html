<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta property="og:url" content="https://newzone.top/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html"><meta property="og:site_name" content="nocetfy"><meta property="og:title" content="杂项"><meta property="og:description" content="杂项 [toc] static 静态方法的使用 在同一个@Configuration配置类内，对static关键字的使用做出如下说明，供以参考： 对于普通类型（非后置处理器类型）的@Bean方法，使用static关键字并不能改变顺序（按照方法定义顺序执行），所以别指望它 static关键字一般有且仅用于@Bean方法返回为BeanPostProcessor、BeanFactoryPostProcessor等类型的方法，并且建议此种方法请务必使用static修饰，否则容易导致隐患，埋雷，还可以解除Spring的日志警告"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"杂项","image":[""],"dateModified":null,"author":[]}</script><title>杂项 | nocetfy</title><meta name="description" content="杂项 [toc] static 静态方法的使用 在同一个@Configuration配置类内，对static关键字的使用做出如下说明，供以参考： 对于普通类型（非后置处理器类型）的@Bean方法，使用static关键字并不能改变顺序（按照方法定义顺序执行），所以别指望它 static关键字一般有且仅用于@Bean方法返回为BeanPostProcessor、BeanFactoryPostProcessor等类型的方法，并且建议此种方法请务必使用static修饰，否则容易导致隐患，埋雷，还可以解除Spring的日志警告">
    <meta name="keywords" content="自我提升,效率提升,开源工具,学习笔记" />
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #252232;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/MyNotes/assets/style-fdc52a0b.css" as="style"><link rel="stylesheet" href="/MyNotes/assets/style-fdc52a0b.css">
    <link rel="modulepreload" href="/MyNotes/assets/app-59c87434.js"><link rel="modulepreload" href="/MyNotes/assets/framework-1ee2252c.js"><link rel="modulepreload" href="/MyNotes/assets/Spring 杂项.html-b64ee977.js"><link rel="modulepreload" href="/MyNotes/assets/Spring 杂项.html-b9180fac.js">

    <!-- 看板娘区块 -->
    <link href="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-y/font-awesome/6.0.0/css/all.min.css" type="text/css" rel="stylesheet" />
    <script src="/live2d-widget/autoload.js"></script>
    <!-- End 看板娘区块 -->

    <!-- Matomo 此区块为统计代码，请删除-->
    <script>
      var _paq = window._paq = window._paq || [];
      /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
        var u="https://piwik.seoipo.com/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '7']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
    <!-- End Matomo Code 此区块为统计代码，请删除-->

  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">跳至主要內容</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/MyNotes/" class="brand"><img class="logo" src="/MyNotes/logo.svg" alt="nocetfy"><!----><span class="site-name hide-in-pad">nocetfy</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/MyNotes/blog" class="nav-link" aria-label="博客"><span class="font-icon icon iconfont icon-blog" style=""></span>博客<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="代码"><span class="title"><span class="font-icon icon iconfont icon-code" style=""></span>代码</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/MyNotes/code/Markdown" class="nav-link" aria-label="/code/Markdown"><!---->/code/Markdown<!----></a></li><li class="dropdown-item"><a href="/MyNotes/code/AutoHotkey" class="nav-link" aria-label="/code/AutoHotkey"><!---->/code/AutoHotkey<!----></a></li><li class="dropdown-item"><a href="/MyNotes/code/Electron" class="nav-link" aria-label="/code/Electron"><!---->/code/Electron<!----></a></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>页面开发</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/MyNotes/web/VuePress" class="nav-link" aria-label="/web/VuePress"><!---->/web/VuePress<!----></a></li><li class="dropdown-subitem"><a href="/MyNotes/web/docsify" class="nav-link" aria-label="/web/docsify"><!---->/web/docsify<!----></a></li><li class="dropdown-subitem"><a href="/MyNotes/deploy/VPS" class="nav-link" aria-label="/deploy/VPS"><!---->/deploy/VPS<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="应用"><span class="title"><span class="font-icon icon iconfont icon-app" style=""></span>应用</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/MyNotes/apps/Applist" class="nav-link" aria-label="/apps/Applist"><!---->/apps/Applist<!----></a></li><li class="dropdown-item"><a href="/MyNotes/apps/ChatGPT" class="nav-link" aria-label="/apps/ChatGPT"><!---->/apps/ChatGPT<!----></a></li><li class="dropdown-item"><a href="/MyNotes/apps/livestreaming/1_obs_basic" class="nav-link" aria-label="直播手册"><span class="font-icon icon iconfont icon-quote" style=""></span>直播手册<!----></a></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>服务/系统</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/MyNotes/services/NAS" class="nav-link" aria-label="/services/NAS"><!---->/services/NAS<!----></a></li><li class="dropdown-subitem"><a href="/MyNotes/windows/faq" class="nav-link" aria-label="/windows/faq"><!---->/windows/faq<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="生活"><span class="title"><span class="font-icon icon iconfont icon-emmet" style=""></span>生活</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/MyNotes/family/Diet" class="nav-link" aria-label="/family/Diet"><!---->/family/Diet<!----></a></li><li class="dropdown-item"><a href="/MyNotes/family/Shoppinglist" class="nav-link" aria-label="/family/Shoppinglist"><!---->/family/Shoppinglist<!----></a></li><li class="dropdown-item"><a href="/MyNotes/family/Coupon" class="nav-link" aria-label="/family/Coupon"><!---->/family/Coupon<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="https://nav.newzone.top/" rel="noopener noreferrer" target="_blank" aria-label="工具收藏" class="nav-link"><span class="font-icon icon iconfont icon-tool" style=""></span>工具收藏<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><div class="nav-item"><a class="repo-link" href="https://github.com/nocetfy" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!--[--><button class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg></button><!--]--><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">🧰 算法笔记</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">🚀 面试笔记</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-ability" style=""></span><span class="title">计算机基础</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-ability" style=""></span><span class="title">Java</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-ability" style=""></span><span class="title">MySQL</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-ability" style=""></span><span class="title">Redis</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-ability" style=""></span><span class="title">消息队列</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="font-icon icon iconfont icon-ability" style=""></span><span class="title">框架</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20Cache.html" class="nav-link sidebar-link sidebar-page" aria-label="/interview/框架/Spring Cache.md"><!---->/interview/框架/Spring Cache.md<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20AOP.html" class="nav-link sidebar-link sidebar-page" aria-label="AOP"><!---->AOP<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20Boot.html" class="nav-link sidebar-link sidebar-page" aria-label="Boot"><!---->Boot<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Dubbo.html" class="nav-link sidebar-link sidebar-page" aria-label="Dubbo"><!---->Dubbo<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20MVC.html" class="nav-link sidebar-link sidebar-page" aria-label="MVC"><!---->MVC<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Mybatis.html" class="nav-link sidebar-link sidebar-page" aria-label="Mybatis"><!---->Mybatis<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20IOC.html" class="nav-link sidebar-link sidebar-page" aria-label="Spring IOC"><!---->Spring IOC<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%B1%BB.html" class="nav-link sidebar-link sidebar-page" aria-label="常用工具类"><!---->常用工具类<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="杂项"><!---->杂项<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#static" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="static"><!---->static<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#静态方法的使用" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="静态方法的使用"><!---->静态方法的使用<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#静态内部类的使用" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="静态内部类的使用"><!---->静态内部类的使用<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#静态注入" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="静态注入"><!---->静态注入<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#资源" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="资源"><!---->资源<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#resourceloader" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ResourceLoader"><!---->ResourceLoader<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#属性配置" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="属性配置"><!---->属性配置<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#propertysource" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="PropertySource"><!---->PropertySource<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#propertyresolver" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="PropertyResolver"><!---->PropertyResolver<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#environment" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Environment"><!---->Environment<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#value" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="@Value"><!---->@Value<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#数据转换" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="数据转换"><!---->数据转换<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#propertyeditor" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="PropertyEditor"><!---->PropertyEditor<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#converter、genericconverter" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Converter、GenericConverter"><!---->Converter、GenericConverter<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#conversionservice" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ConversionService"><!---->ConversionService<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#typeconvert" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="TypeConvert"><!---->TypeConvert<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#数据绑定" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="数据绑定"><!---->数据绑定<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#propertyaccessor" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="PropertyAccessor"><!---->PropertyAccessor<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#beanwrapper" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="BeanWrapper"><!---->BeanWrapper<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#databinder" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="DataBinder"><!---->DataBinder<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#数据校验" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="数据校验"><!---->数据校验<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#常用注解" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="常用注解"><!---->常用注解<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#validated和-valid的区别" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="@Validated和@Valid的区别"><!---->@Validated和@Valid的区别<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#分组校验" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="分组校验"><!---->分组校验<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#spel" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="SpEL"><!---->SpEL<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-ability" style=""></span><span class="title">数据结构与算法</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-ability" style=""></span><span class="title">网络</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-ability" style=""></span><span class="title">架构</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-ability" style=""></span><span class="title">分布式</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-ability" style=""></span><span class="title">运维开发</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-ability" style=""></span><span class="title">开放设计</span><span class="arrow right"></span></button><!----></section></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->杂项</h1><div class="page-info"><!----><!----><span class="page-word-info" aria-label="字数🔠" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>约 13574 字</span><meta property="wordCount" content="13574"></span><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 45 分钟</span><meta property="timeRequired" content="PT45M"></span><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容<button class="print-button" title="print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#static" class="router-link-active router-link-exact-active toc-link level2">static</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#静态方法的使用" class="router-link-active router-link-exact-active toc-link level3">静态方法的使用</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#静态内部类的使用" class="router-link-active router-link-exact-active toc-link level3">静态内部类的使用</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#静态注入" class="router-link-active router-link-exact-active toc-link level3">静态注入</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#资源" class="router-link-active router-link-exact-active toc-link level2">资源</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#resourceloader" class="router-link-active router-link-exact-active toc-link level3">ResourceLoader</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#属性配置" class="router-link-active router-link-exact-active toc-link level2">属性配置</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#propertysource" class="router-link-active router-link-exact-active toc-link level3">PropertySource</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#propertyresolver" class="router-link-active router-link-exact-active toc-link level3">PropertyResolver</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#environment" class="router-link-active router-link-exact-active toc-link level3">Environment</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#value" class="router-link-active router-link-exact-active toc-link level3">@Value</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#数据转换" class="router-link-active router-link-exact-active toc-link level2">数据转换</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#propertyeditor" class="router-link-active router-link-exact-active toc-link level3">PropertyEditor</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#converter、genericconverter" class="router-link-active router-link-exact-active toc-link level3">Converter、GenericConverter</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#conversionservice" class="router-link-active router-link-exact-active toc-link level3">ConversionService</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#typeconvert" class="router-link-active router-link-exact-active toc-link level3">TypeConvert</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#数据绑定" class="router-link-active router-link-exact-active toc-link level2">数据绑定</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#propertyaccessor" class="router-link-active router-link-exact-active toc-link level3">PropertyAccessor</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#beanwrapper" class="router-link-active router-link-exact-active toc-link level3">BeanWrapper</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#databinder" class="router-link-active router-link-exact-active toc-link level3">DataBinder</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#数据校验" class="router-link-active router-link-exact-active toc-link level2">数据校验</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#常用注解" class="router-link-active router-link-exact-active toc-link level3">常用注解</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#validated和-valid的区别" class="router-link-active router-link-exact-active toc-link level3">@Validated和@Valid的区别</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#分组校验" class="router-link-active router-link-exact-active toc-link level3">分组校验</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/Spring%20%E6%9D%82%E9%A1%B9.html#spel" class="router-link-active router-link-exact-active toc-link level2">SpEL</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="杂项" tabindex="-1"><a class="header-anchor" href="#杂项" aria-hidden="true">#</a> 杂项</h1><p>[toc]</p><h2 id="static" tabindex="-1"><a class="header-anchor" href="#static" aria-hidden="true">#</a> static</h2><h3 id="静态方法的使用" tabindex="-1"><a class="header-anchor" href="#静态方法的使用" aria-hidden="true">#</a> 静态方法的使用</h3><p>在同一个<code>@Configuration</code>配置类内，对static关键字的使用做出如下说明，供以参考：</p><ol><li>对于普通类型（非后置处理器类型）的@Bean方法，使用static关键字并不能改变顺序（按照方法定义顺序执行），所以别指望它</li><li>static关键字一般有且仅用于@Bean方法返回为<code>BeanPostProcessor</code>、<code>BeanFactoryPostProcessor</code>等类型的方法，并且建议此种方法<strong>请务必使用static修饰</strong>，否则容易导致隐患，埋雷，还可以解除Spring的日志警告</li></ol><p>​ static关键字不要滥用（其实任何关键字皆勿乱用），在同一配置类内，<strong>与其说它是提升了Bean的优先级，倒不如说它让@Bean方法静态化从而不再需要依赖所在类的实例即可独立运行</strong>。</p><h3 id="静态内部类的使用" tabindex="-1"><a class="header-anchor" href="#静态内部类的使用" aria-hidden="true">#</a> 静态内部类的使用</h3><ol><li><p>跨.java文件</p><p>（跨配置类）之间的顺序，是由自然顺序来保证的（字母表顺序）</p><p>如：先加载A打头的配置类（含静态内部类），再是O打头的，再是Z打头的</p></li><li><p>同一.java文件内部，static静态内部类优先于外部类初始化。若有多个静态内部类，那么按照类名自然排序初始化（并非按照定义顺序哦，请务必注意）</p><p>说明：一般内部类只可能与外部类“发生关系”，与兄弟之间不建议有任何联系，否则顺序控制上你就得当心了。毕竟靠自然顺序去保证是一种弱保证，容错性太低</p></li><li><p>同一.java文件内，不同类内的@Bean方法之间的执行顺序，保持同2一致（也就说你的@Bean所在的@Configuration配置类先加载，那你就优先被初始化喽）</p><p>同一Class内多个@Bean方法的执行顺序，会根据定义顺序，由字节码顺序保证(后置处理器类型除外）。</p></li></ol><p>总的来说，当static标注在class类上时，在<strong>同.java文件内</strong>它是能够提升优先级的，这对于<code>Spring Boot</code>的自动配置非常有意义，主要体现在如下两个方法：</p><ul><li>static静态内部类配置优先于外部类加载，从而静态内部类里面的@Bean也<strong>优先于</strong>外部类的@Bean先加载</li><li>既然这样，那么Spring Boot自动配置就可以结合此特性，就可以进行具有优先级的<code>@Conditional</code>条件判断了。这里我举个官方的例子，你便能感受到它的魅力所在：</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FeignClientsConfiguration</span> <span class="token punctuation">{</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token annotation punctuation">@Bean</span>
	<span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span><span class="token string">&quot;prototype&quot;</span><span class="token punctuation">)</span>
	<span class="token annotation punctuation">@ConditionalOnMissingBean</span>
	<span class="token keyword">public</span> <span class="token class-name">Feign<span class="token punctuation">.</span>Builder</span> <span class="token function">feignBuilder</span><span class="token punctuation">(</span><span class="token class-name">Retryer</span> retryer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token class-name">Feign</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">retryer</span><span class="token punctuation">(</span>retryer<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Configuration</span>
	<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">HystrixCommand</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">HystrixFeign</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">protected</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">HystrixFeignConfiguration</span> <span class="token punctuation">{</span>
		<span class="token annotation punctuation">@Bean</span>
		<span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span><span class="token string">&quot;prototype&quot;</span><span class="token punctuation">)</span>
		<span class="token annotation punctuation">@ConditionalOnMissingBean</span>
		<span class="token annotation punctuation">@ConditionalOnProperty</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;feign.hystrix.enabled&quot;</span><span class="token punctuation">)</span>
		<span class="token keyword">public</span> <span class="token class-name">Feign<span class="token punctuation">.</span>Builder</span> <span class="token function">feignHystrixBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token class-name">HystrixFeign</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 因为<code>HystrixFeign.builder()</code>它属于静态内部类，所以这个@Bean肯定是优先于外部的<code>Feign.builder()</code>先加载的。所以这段逻辑可解释为：优先使用<code>HystrixFeign.builder()</code>（若条件满足），否则使用<code>Feign.builder().retryer(retryer)</code>作为兜底。通过此例你应该再一次感受到<strong>Bean的加载顺序之于Spring应用的重要性</strong>，特别在Spring Boot/Cloud下此特性尤为凸显。</p><h3 id="静态注入" tabindex="-1"><a class="header-anchor" href="#静态注入" aria-hidden="true">#</a> 静态注入</h3><p>方式1</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserHelper</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token class-name">UCClient</span> ucClient<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUcClient</span><span class="token punctuation">(</span><span class="token class-name">UCClient</span> ucClient<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">UserHelper</span><span class="token punctuation">.</span>ucClient <span class="token operator">=</span> ucClient<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>方式2</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserHelper</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token class-name">UCClient</span> ucClient<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@PostConstruct</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">UserHelper</span><span class="token punctuation">.</span>ucClient <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">UCClient</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>方式3</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserHelper</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token class-name">UCClient</span> ucClient<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUcClient</span><span class="token punctuation">(</span><span class="token class-name">UCClient</span> ucClient<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">UserHelper</span><span class="token punctuation">.</span>ucClient <span class="token operator">=</span> ucClient<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AutowireStaticSmartInitializingSingleton</span> <span class="token keyword">implements</span> <span class="token class-name">SmartInitializingSingleton</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AutowireCapableBeanFactory</span> beanFactory<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 当所有的单例Bena初始化完成后，对static静态成员进行赋值
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterSingletonsInstantiated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 因为是给static静态属性赋值，因此这里new一个实例做注入是可行的</span>
        beanFactory<span class="token punctuation">.</span><span class="token function">autowireBean</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UserHelper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>方式4</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserHelper</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token class-name">UCClient</span> ucClient<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUcClient</span><span class="token punctuation">(</span><span class="token class-name">UCClient</span> ucClient<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">UserHelper</span><span class="token punctuation">.</span>ucClient <span class="token operator">=</span> ucClient<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AutowireStaticSmartInitializingSingleton</span> <span class="token keyword">implements</span> <span class="token class-name">SmartInitializingSingleton</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AutowiredAnnotationBeanPostProcessor</span> autowiredAnnotationBeanPostProcessor<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterSingletonsInstantiated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        autowiredAnnotationBeanPostProcessor<span class="token punctuation">.</span><span class="token function">processInjection</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UserHelper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3和4的好处：</p><ol><li>手动管理这种case的依赖注入，更可控。而非交给Spring容器去自动处理</li><li>工具类<strong>本身</strong>并不需要加入到Spring容器内，这对于有大量这种case的话，是可以节约开销的</li></ol><hr><h2 id="资源" tabindex="-1"><a class="header-anchor" href="#资源" aria-hidden="true">#</a> 资源</h2><p>资源粗略的可以分为（这里以Spring的分类为例）：</p><ol><li>URL资源</li><li>File资源</li><li>ClassPath相关资源</li><li>服务器相关资源（JBoss AS 5.x上的VFS资源）</li></ol><p>​ JDK操纵底层资源基本就是<code>java.net.URL 、java.io.File 、java.util.Properties</code>这些：取资源基本是根据绝对路径或当前类的相对路径来取。从类路径或Web容器上下文中获取资源的时候也不方便。<strong>若直接使用这些方法，需要编写比较多的额外代码，例如前期文件存在判断、相对路径变绝对路径等。</strong></p><p>而Spring提供的<code>Resource</code>接口提供了更强大的<strong>访问底层资源的能力</strong>。</p><p>Spring为我们提供了非常多的实现类。</p><ul><li>ByteArrayResource</li><li>InputStreamResource</li><li>FileSystemResource</li><li>UrlResource</li><li>ClassPathResource</li><li>ServletContextResource</li></ul><h3 id="resourceloader" tabindex="-1"><a class="header-anchor" href="#resourceloader" aria-hidden="true">#</a> ResourceLoader</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// @since 10.03.2004  小细节：Resource接口是@since 28.12.2003   所以这个接口晚了大概4个月的样子</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ResourceLoader</span> <span class="token punctuation">{</span>
	<span class="token comment">// 常量：classpath:</span>
	<span class="token comment">// 其实ResourceLoader接口只提供了classpath前缀的支持。而classpath*的前缀支持是在它的子接口ResourcePatternResolver中</span>
	<span class="token class-name">String</span> <span class="token constant">CLASSPATH_URL_PREFIX</span> <span class="token operator">=</span> <span class="token class-name">ResourceUtils</span><span class="token punctuation">.</span><span class="token constant">CLASSPATH_URL_PREFIX</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 这个方法可谓是核心方法：返回Resource实例</span>
	<span class="token comment">// 它的目的很简单：就是希望程序员在使用时，不需要太在意使用的是哪个实例。面向接口操作即可</span>
	<span class="token comment">// 至于选取哪个实例去操作，交给框架来完成</span>
	<span class="token class-name">Resource</span> <span class="token function">getResource</span><span class="token punctuation">(</span><span class="token class-name">String</span> location<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// Expose the ClassLoader used by this ResourceLoader.</span>
	<span class="token comment">// 暴露出ResourceLoader使用的类加载器~~~</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token class-name">ClassLoader</span> <span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 从上可以看出：程序员在使用Spring容器时，可以不去过于计较底层Resource的实现，也不需要自己创建Resource实现类，而是直接使用<code>applicationContext.getResource()</code>，获取到bean容器本身的Resource，进而取到相关的资源信息。</p><figure><img src="https://raw.githubusercontent.com/nocetfy/image/main/img/image-20231029182235233.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// @since 10.03.2004</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultResourceLoader</span> <span class="token keyword">implements</span> <span class="token class-name">ResourceLoader</span> <span class="token punctuation">{</span>
	
	<span class="token comment">// 这里面classLoader是允许为null的</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token keyword">private</span> <span class="token class-name">ClassLoader</span> classLoader<span class="token punctuation">;</span>
	<span class="token comment">// 这个特别重要：ProtocolResolver这个接口事Spring为开发者提供了自定义扩展接口（允许我们自己去介入参与到具体的获取资源的处理上，后面getResouce方法可议看出来）</span>
	<span class="token comment">// ProtocolResolver接口Spring没有提供任何实现，开发者可议自己实现，从而参与到资源获取的路子上去</span>
	<span class="token comment">// 备注：这个接口@since 4.3  所以只有Spring4.3后才有这个能力哦~~~</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProtocolResolver</span><span class="token punctuation">&gt;</span></span> protocolResolvers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">Resource</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> resourceCaches <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// ClassLoader可以不指定（一般情况下也不需要指定）</span>
	<span class="token keyword">public</span> <span class="token class-name">DefaultResourceLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>classLoader <span class="token operator">=</span> <span class="token class-name">ClassUtils</span><span class="token punctuation">.</span><span class="token function">getDefaultClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token class-name">DefaultResourceLoader</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ClassLoader</span> classLoader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>classLoader <span class="token operator">=</span> classLoader<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 我们可以自己实现一个ProtocolResolver ，然后实现我们自己的获取资源的逻辑~~~下面会有示例</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addProtocolResolver</span><span class="token punctuation">(</span><span class="token class-name">ProtocolResolver</span> resolver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>resolver<span class="token punctuation">,</span> <span class="token string">&quot;ProtocolResolver must not be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>protocolResolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>resolver<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// @since 5.0  和ASM有关</span>
	<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Resource</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">getResourceCache</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> valueType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Resource</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resourceCaches<span class="token punctuation">.</span><span class="token function">computeIfAbsent</span><span class="token punctuation">(</span>valueType<span class="token punctuation">,</span> key <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token comment">// 这个是核心方法~~~</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">Resource</span> <span class="token function">getResource</span><span class="token punctuation">(</span><span class="token class-name">String</span> location<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span> <span class="token string">&quot;Location must not be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token comment">// 首先，Spring会看我们自己有没有实现自己的ProtocolResolver 若有实现，会先以我们自己的为准</span>
		<span class="token comment">// 备注：它会把ResourceLoader传给开发者，这点特别重要~~~</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ProtocolResolver</span> protocolResolver <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>protocolResolvers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">Resource</span> resource <span class="token operator">=</span> protocolResolver<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>resource <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">return</span> resource<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		
		<span class="token comment">// 如果以/打头，就交给getResourceByPath()，注意，它是一个protected方法，子类是可议复写的</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>location<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token function">getResourceByPath</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 如果以classpath:打头，毫无疑问，交给ClassPathResource</span>
		<span class="token comment">// 需要注意的是，此处必须`classpath:`  区分大小写的哦</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>location<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token constant">CLASSPATH_URL_PREFIX</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token constant">CLASSPATH_URL_PREFIX</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 最后的处理方式：就是当作一个URL来处理</span>
		<span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">try</span> <span class="token punctuation">{</span>
				<span class="token comment">// Try to parse the location as a URL...</span>
				<span class="token comment">// 如果是文件类型，交给FileUrlResource（@since 5.0.2）</span>
				<span class="token class-name">URL</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">ResourceUtils</span><span class="token punctuation">.</span><span class="token function">isFileURL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">FileUrlResource</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">UrlResource</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MalformedURLException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// No URL -&gt; resolve as resource path.</span>
				<span class="token comment">// fallback  相当于还是交给子类去弄吧</span>
				<span class="token keyword">return</span> <span class="token function">getResourceByPath</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">// 它是一个protected方法，很多子类都有重写它。可以看到，默认的处理方式是：去classpth里查找这个资源</span>
	<span class="token comment">// ClassPathContextResource是一个protected内部类  extends ClassPathResource implements ContextResource</span>
	<span class="token keyword">protected</span> <span class="token class-name">Resource</span> <span class="token function">getResourceByPath</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathContextResource</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="resourcepatternresolver" tabindex="-1"><a class="header-anchor" href="#resourcepatternresolver" aria-hidden="true">#</a> ResourcePatternResolver</h4><p>​ 它使用得反而更加的广泛，也更加的强大。从名字中可以看出，<strong>它支持</strong><code>Pattern</code><strong>，支持正则的模式匹配，非常的强大</strong>，用于解析资源文件的<code>策略接口</code>，其特殊的地方在于，它应该提供带有<code>*</code>号这种通配符的资源路径。 此接口是ResourceLoader接口的拓展接口。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// @since 1.0.2 显然它出现的时机晚于ResourceLoader接口</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ResourcePatternResolver</span> <span class="token keyword">extends</span> <span class="token class-name">ResourceLoader</span> <span class="token punctuation">{</span>

	<span class="token comment">// 与ResourceLoader中classpath不同的地方在于，此前缀会在所有的JAR包的根目录下搜索指定文件。  非常的强大</span>
	<span class="token class-name">String</span> <span class="token constant">CLASSPATH_ALL_URL_PREFIX</span> <span class="token operator">=</span> <span class="token string">&quot;classpath*:&quot;</span><span class="token punctuation">;</span>
	<span class="token comment">// 返回指定路径下所有的资源对象。</span>
	<span class="token comment">// 返回的对象数组有Set的语义，也就是说，`对于同一个资源，只返回一个资源对象`</span>
	<span class="token class-name">Resource</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getResources</span><span class="token punctuation">(</span><span class="token class-name">String</span> locationPattern<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="pathmatchingresourcepatternresolver" tabindex="-1"><a class="header-anchor" href="#pathmatchingresourcepatternresolver" aria-hidden="true">#</a> PathMatchingResourcePatternResolver</h5><pre><code>它是基于`模式匹配`的，默认使用`org.springframework.util.AntPathMatcher`进行路径匹配，它除了支持`ResourceLoader`支持的前缀外，还额外支持`classpath*:`用于加载所有匹配的类路径`Resource`
</code></pre><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PathMatchingResourcePatternResolver</span> <span class="token keyword">implements</span> <span class="token class-name">ResourcePatternResolver</span> <span class="token punctuation">{</span>
	<span class="token comment">// 内部持有一个resourceLoader的引用</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ResourceLoader</span> resourceLoader<span class="token punctuation">;</span>
	<span class="token comment">// 我们发现，它内部使用是AntPathMatcher进行匹配的（Spring内部AntPathMatcher是PathMatcher接口的唯一实现。</span>
	<span class="token comment">// 如果你想改变此匹配规则，你可以自己实现（当然这是完全没必要的））</span>
	<span class="token keyword">private</span> <span class="token class-name">PathMatcher</span> pathMatcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AntPathMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 默认使用的DefaultResourceLoader  当然也可以指定</span>
	<span class="token keyword">public</span> <span class="token class-name">PathMatchingResourcePatternResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>resourceLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultResourceLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token class-name">PathMatchingResourcePatternResolver</span><span class="token punctuation">(</span><span class="token class-name">ResourceLoader</span> resourceLoader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>resourceLoader<span class="token punctuation">,</span> <span class="token string">&quot;ResourceLoader must not be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>resourceLoader <span class="token operator">=</span> resourceLoader<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token class-name">PathMatchingResourcePatternResolver</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ClassLoader</span> classLoader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>resourceLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultResourceLoader</span><span class="token punctuation">(</span>classLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	
	<span class="token comment">// 显然，我们也可以自己指定解析器，默认使用AntPathMatcher</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPathMatcher</span><span class="token punctuation">(</span><span class="token class-name">PathMatcher</span> pathMatcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>pathMatcher<span class="token punctuation">,</span> <span class="token string">&quot;PathMatcher must not be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>pathMatcher <span class="token operator">=</span> pathMatcher<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 最终是委托给ResourceLoader去做了</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">Resource</span> <span class="token function">getResource</span><span class="token punctuation">(</span><span class="token class-name">String</span> location<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token function">getResourceLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 这个是核心方法~~~~~~~</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">Resource</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getResources</span><span class="token punctuation">(</span><span class="token class-name">String</span> locationPattern<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
		<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>locationPattern<span class="token punctuation">,</span> <span class="token string">&quot;Location pattern must not be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// 以`classpath*:`打头~~~</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>locationPattern<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token constant">CLASSPATH_ALL_URL_PREFIX</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// 把前最后面那部分截取出来，看看是否是模版(包含*和?符号都属于模版，否则不是)</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getPathMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isPattern</span><span class="token punctuation">(</span>locationPattern<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token constant">CLASSPATH_ALL_URL_PREFIX</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// a class path resource pattern</span>
				<span class="token comment">// 是pattern，那就交给这个方法，这个是个核心方法   这里传入的是locationPattern</span>
				<span class="token keyword">return</span> <span class="token function">findPathMatchingResources</span><span class="token punctuation">(</span>locationPattern<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token punctuation">{</span>
				<span class="token comment">// all class path resources with the given name</span>
				<span class="token comment">// 如果不是pattern，那就完全匹配。去找所有的path下的匹配上的就成~~~</span>
				<span class="token keyword">return</span> <span class="token function">findAllClassPathResources</span><span class="token punctuation">(</span>locationPattern<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token constant">CLASSPATH_ALL_URL_PREFIX</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		
		<span class="token comment">// 不是以`classpath*:`打头的~~~~</span>
		<span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token comment">// 支持到tomcat的war:打头的方式~~~</span>
			<span class="token keyword">int</span> prefixEnd <span class="token operator">=</span> <span class="token punctuation">(</span>locationPattern<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;war:&quot;</span><span class="token punctuation">)</span> <span class="token operator">?</span>  locationPattern<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;*/&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">:</span>
					locationPattern<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token char">&#39;:&#39;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getPathMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isPattern</span><span class="token punctuation">(</span>locationPattern<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>prefixEnd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token function">findPathMatchingResources</span><span class="token punctuation">(</span>locationPattern<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			
			<span class="token comment">// 如果啥都不打头，那就当作一个正常的处理,委托给ResourceLoader直接去处理</span>
			<span class="token keyword">else</span> <span class="token punctuation">{</span>
				<span class="token comment">// a single resource with the given name</span>
				<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Resource</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token function">getResourceLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span>locationPattern<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 根据Pattern去匹配资源~~~~</span>
	<span class="token keyword">protected</span> <span class="token class-name">Resource</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">findPathMatchingResources</span><span class="token punctuation">(</span><span class="token class-name">String</span> locationPattern<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
		<span class="token comment">// 定位到跟文件夹地址。比如locationPattern=classpath:META-INF/spring.factories  得到classpath*:META-INF/</span>
		<span class="token comment">// 若是classpath*:META-INF/ABC/*.factories 得到的就是 classpath*:META-INF/ABC/</span>
		<span class="token comment">// 简单的说，就是截取第一个不是pattern的地方的前半部分</span>
		<span class="token class-name">String</span> rootDirPath <span class="token operator">=</span> <span class="token function">determineRootDir</span><span class="token punctuation">(</span>locationPattern<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 后半部分  这里比如就是：*.factories</span>
		<span class="token class-name">String</span> subPattern <span class="token operator">=</span> locationPattern<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>rootDirPath<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token comment">// 这个递归就厉害了，继续调用了getResources(&quot;classpath*:META-INF/&quot;)方法</span>
		<span class="token comment">// 相当于把该文件夹匹配的所有的资源（注意：可能会比较多的），最后在和pattern匹配即可~~~~</span>
		<span class="token comment">// 比如此处：只要jar里面有META-INF目录的  都会被匹配进来~~~~~~</span>
		<span class="token class-name">Resource</span><span class="token punctuation">[</span><span class="token punctuation">]</span> rootDirResources <span class="token operator">=</span> <span class="token function">getResources</span><span class="token punctuation">(</span>rootDirPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Resource</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Resource</span> rootDirResource <span class="token operator">:</span> rootDirResources<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// resolveRootDirResource是留给子类去复写的。但是Spring没有子类复写此方法，默认实现是啥都没做~~~</span>
			rootDirResource <span class="token operator">=</span> <span class="token function">resolveRootDirResource</span><span class="token punctuation">(</span>rootDirResource<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">URL</span> rootDirUrl <span class="token operator">=</span> rootDirResource<span class="token punctuation">.</span><span class="token function">getURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			<span class="token comment">// 这个if就一般不看了  是否为了做兼容~~~</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>equinoxResolveMethod <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> rootDirUrl<span class="token punctuation">.</span><span class="token function">getProtocol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;bundle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token class-name">URL</span> resolvedUrl <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token constant">URL</span><span class="token punctuation">)</span> <span class="token class-name">ReflectionUtils</span><span class="token punctuation">.</span><span class="token function">invokeMethod</span><span class="token punctuation">(</span>equinoxResolveMethod<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> rootDirUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>resolvedUrl <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					rootDirUrl <span class="token operator">=</span> resolvedUrl<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				rootDirResource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UrlResource</span><span class="token punctuation">(</span>rootDirUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>


			<span class="token comment">// 支持vfs协议（JBoss)~~~</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>rootDirUrl<span class="token punctuation">.</span><span class="token function">getProtocol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token class-name">ResourceUtils</span><span class="token punctuation">.</span><span class="token constant">URL_PROTOCOL_VFS</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				result<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token class-name">VfsResourceMatchingDelegate</span><span class="token punctuation">.</span><span class="token function">findMatchingResources</span><span class="token punctuation">(</span>rootDirUrl<span class="token punctuation">,</span> subPattern<span class="token punctuation">,</span> <span class="token function">getPathMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		
			<span class="token comment">// 是否是jar文件或者是jar资源(显然大多数情况下都是此情况~~~)</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ResourceUtils</span><span class="token punctuation">.</span><span class="token function">isJarURL</span><span class="token punctuation">(</span>rootDirUrl<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isJarResource</span><span class="token punctuation">(</span>rootDirResource<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// 把rootDirUrl, subPattern都交给doFindPathMatchingJarResources去处理</span>
				result<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token function">doFindPathMatchingJarResources</span><span class="token punctuation">(</span>rootDirResource<span class="token punctuation">,</span> rootDirUrl<span class="token punctuation">,</span> subPattern<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			
			<span class="token comment">// 不是Jar文件（那就是本工程里字的META-INF目录~~~）</span>
			<span class="token comment">// 那就没啥好说的，直接给个subPattern去匹配吧   注意这个方法名是File，上面是jar</span>
			<span class="token keyword">else</span> <span class="token punctuation">{</span>
				result<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token function">doFindPathMatchingFileResources</span><span class="token punctuation">(</span>rootDirResource<span class="token punctuation">,</span> subPattern<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		
		<span class="token comment">// 最终转换为数组返回。 注意此处的result是个set，是有去重的效果的~~~</span>
		<span class="token keyword">return</span> result<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Resource</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">protected</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Resource</span><span class="token punctuation">&gt;</span></span> <span class="token function">doFindPathMatchingJarResources</span><span class="token punctuation">(</span><span class="token class-name">Resource</span> rootDirResource<span class="token punctuation">,</span> <span class="token class-name">URL</span> rootDirURL<span class="token punctuation">,</span> <span class="token class-name">String</span> subPattern<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment">// 这个方法就源码不细说了，</span>
		<span class="token comment">// Find all resources in jar files that match the given location pattern</span>
		<span class="token comment">// 就是去这个jar里面去找所有的资源（默认利用Ant风格匹配~）</span>
		<span class="token comment">// 此处用到了`java.util.jar.JarFile`、`ZipFile`、`java.net.JarURLConnection`等等</span>
		<span class="token comment">// 路径匹配：getPathMatcher().match(subPattern, relativePath) 使用的此方法去校对</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Find all resources in the file system that match the given location pattern</span>
	<span class="token comment">// 简单的说，这个就是在我们自己的项目里找~~~~</span>
	<span class="token keyword">protected</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Resource</span><span class="token punctuation">&gt;</span></span> <span class="token function">doFindPathMatchingFileResources</span><span class="token punctuation">(</span><span class="token class-name">Resource</span> rootDirResource<span class="token punctuation">,</span> <span class="token class-name">String</span> subPattern<span class="token punctuation">)</span>
			<span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>

		<span class="token comment">// rootDir:最终是个绝对的路径地址，带盘符的。来代表META-INF这个文件夹~~~</span>
		<span class="token class-name">File</span> rootDir<span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			rootDir <span class="token operator">=</span> rootDirResource<span class="token punctuation">.</span><span class="token function">getFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAbsoluteFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// FileSystem  最终是根据此绝对路径 去文件系统里找</span>
		<span class="token keyword">return</span> <span class="token function">doFindMatchingFileSystemResources</span><span class="token punctuation">(</span>rootDir<span class="token punctuation">,</span> subPattern<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 这个比较简单：就是把该文件夹所有的文件都拿出来dir.listFiles()，然后一个个去匹配呗~~~~</span>
	<span class="token comment">// 备注：子类`ServletContextResourcePatternResolver`复写了此方法~~~~~</span>
	<span class="token keyword">protected</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Resource</span><span class="token punctuation">&gt;</span></span> <span class="token function">doFindMatchingFileSystemResources</span><span class="token punctuation">(</span><span class="token class-name">File</span> rootDir<span class="token punctuation">,</span> <span class="token class-name">String</span> subPattern<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Looking for matching resources in directory tree [&quot;</span> <span class="token operator">+</span> rootDir<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">File</span><span class="token punctuation">&gt;</span></span> matchingFiles <span class="token operator">=</span> <span class="token function">retrieveMatchingFiles</span><span class="token punctuation">(</span>rootDir<span class="token punctuation">,</span> subPattern<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Resource</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>matchingFiles<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">File</span> file <span class="token operator">:</span> matchingFiles<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">]</span>
			<span class="token comment">// 最终用FileSystemResource把File包装成一个Resource~</span>
			result<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileSystemResource</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> result<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="属性配置" tabindex="-1"><a class="header-anchor" href="#属性配置" aria-hidden="true">#</a> 属性配置</h2><p>Spring属性管理核心API主要包括下面4个部分：</p><ol><li><strong>PropertySource</strong>：属性源。key-value属性对抽象</li><li><strong>PropertyResolver</strong>：属性解析器。用于解析相应key的value</li><li><strong>Profile</strong>：配置，只有激活的配置profile的组件/配置才会注册到Spring容器，类似于maven中profile</li><li><strong>Environment</strong>：环境，本身也是个属性解析器<code>PropertyResolver</code>。它在基础上还提供了Profile特性，能够很好的对多环境支持。因此我们一般使用它，而不是底层接口<code>PropertyResolver</code>。 可以简单粗暴的把它理解为<strong>Profile 和 PropertyResolver 的组合</strong></li></ol><h3 id="propertysource" tabindex="-1"><a class="header-anchor" href="#propertysource" aria-hidden="true">#</a> PropertySource</h3><p><code>PropertySource</code>是抽象类，<strong>表示一个键值对</strong>，代表着属性源。<code>Spring</code>内部是通过它来承载来自不同地方的属性源的。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// @since 3.1 </span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">PropertySource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

	<span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span> <span class="token comment">// 该属性源的名字</span>
	<span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token class-name">T</span> source<span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">PropertySource</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">T</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">&quot;Property source name must contain at least one character&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token string">&quot;Property source must not be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>source <span class="token operator">=</span> source<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 若没有指定source 默认就是object  而不是null</span>
	<span class="token keyword">public</span> <span class="token class-name">PropertySource</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// getProperty是个抽象方法  子类去实现~~~</span>
	<span class="token comment">// 小细节：若对应的key存在但是值为null，此处也是返回false的  表示不包含~</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">containsProperty</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">getProperty</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">Object</span> <span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>


	<span class="token comment">// 此处特别特别注意重写的这两个方法，我们发现它只和name有关，只要name相等  就代表着是同一个对象~~~~ 这点特别重要~</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> other<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">==</span> other <span class="token operator">||</span> <span class="token punctuation">(</span>other <span class="token keyword">instanceof</span> <span class="token class-name">PropertySource</span> <span class="token operator">&amp;&amp;</span>
				<span class="token class-name">ObjectUtils</span><span class="token punctuation">.</span><span class="token function">nullSafeEquals</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">PropertySource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> other<span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token class-name">ObjectUtils</span><span class="token punctuation">.</span><span class="token function">nullSafeHashCode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>


	<span class="token comment">// 静态方法：根据name就创建一个属性源~  ComparisonPropertySource是StubPropertySource的子类~</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">PropertySource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">named</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ComparisonPropertySource</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="propertyresolver" tabindex="-1"><a class="header-anchor" href="#propertyresolver" aria-hidden="true">#</a> PropertyResolver</h3><p>此接口用于在<strong>底层源</strong>之上解析<strong>一系列</strong>的属性值：例如properties文件,yaml文件,甚至是一些nosql（因为nosql也是k-v形式）。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// @since 3.1  出现得还是相对较晚的  毕竟SpEL也3.0之后才出来嘛~~~</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PropertyResolver</span> <span class="token punctuation">{</span>

	<span class="token comment">// 查看规定指定的key是否有对应的value   注意：若对应值是null的话 也是返回false</span>
	<span class="token keyword">boolean</span> <span class="token function">containsProperty</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 如果没有则返回null</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token class-name">String</span> <span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 如果没有则返回defaultValue</span>
	<span class="token class-name">String</span> <span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> defaultValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 返回指定key对应的value，会解析成指定类型。如果没有对应值则返回null（而不是抛错~）</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> targetType<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> targetType<span class="token punctuation">,</span> <span class="token class-name">T</span> defaultValue<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 若不存在就不是返回null了  而是抛出异常~  所以不用担心返回值是null</span>
	<span class="token class-name">String</span> <span class="token function">getRequiredProperty</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">;</span>
	<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getRequiredProperty</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> targetType<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">;</span>

	<span class="token comment">// 解析${...}这种类型的占位符，把他们替换为使用getProperty方法返回的结果，解析不了并且没有默认值的占位符会被忽略（原样输出）</span>
	<span class="token class-name">String</span> <span class="token function">resolvePlaceholders</span><span class="token punctuation">(</span><span class="token class-name">String</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 解析不了就抛出异常~</span>
	<span class="token class-name">String</span> <span class="token function">resolveRequiredPlaceholders</span><span class="token punctuation">(</span><span class="token class-name">String</span> text<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// @since 3.0  Utility class for working with Strings that have placeholder values in them</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PropertyPlaceholderHelper</span> <span class="token punctuation">{</span>

	<span class="token comment">// 这里保存着  通用的熟悉的 开闭的符号们~~~</span>
	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> wellKnownSimplePrefixes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">static</span> <span class="token punctuation">{</span>
		wellKnownSimplePrefixes<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;}&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;{&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		wellKnownSimplePrefixes<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;]&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;[&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		wellKnownSimplePrefixes<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;)&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;(&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> placeholderPrefix<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> placeholderSuffix<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> simplePrefix<span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> valueSeparator<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> ignoreUnresolvablePlaceholders<span class="token punctuation">;</span> <span class="token comment">// 是否采用严格模式~~</span>

	<span class="token comment">// 从properties里取值  若你有就直接从Properties里取值了~~~</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">replacePlaceholders</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">Properties</span> properties<span class="token punctuation">)</span>  <span class="token punctuation">{</span>
		<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>properties<span class="token punctuation">,</span> <span class="token string">&quot;&#39;properties&#39; must not be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token function">replacePlaceholders</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> properties<span class="token operator">::</span><span class="token function">getProperty</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// @since 4.3.5   抽象类提供这个类型转换的方法~ 需要类型转换的会调用它</span>
	<span class="token comment">// 显然它是委托给了ConversionService，而这个类在前面文章已经都重点分析过了~</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token keyword">protected</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">convertValueIfNecessary</span><span class="token punctuation">(</span><span class="token class-name">Object</span> value<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> targetType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>targetType <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> value<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token class-name">ConversionService</span> conversionServiceToUse <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>conversionService<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>conversionServiceToUse <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// Avoid initialization of shared DefaultConversionService if</span>
			<span class="token comment">// no standard type conversion is needed in the first place...</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ClassUtils</span><span class="token punctuation">.</span><span class="token function">isAssignableValue</span><span class="token punctuation">(</span>targetType<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> value<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			conversionServiceToUse <span class="token operator">=</span> <span class="token class-name">DefaultConversionService</span><span class="token punctuation">.</span><span class="token function">getSharedInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> conversionServiceToUse<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> targetType<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 这里会使用递归，根据传入的符号，默认值等来处理~~~~</span>
	<span class="token keyword">protected</span> <span class="token class-name">String</span> <span class="token function">parseStringValue</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">,</span> <span class="token class-name">PlaceholderResolver</span> placeholderResolver<span class="token punctuation">,</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> visitedPlaceholders<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="environment" tabindex="-1"><a class="header-anchor" href="#environment" aria-hidden="true">#</a> Environment</h3><p>​ 这个接口代表了当前应用正在运行的环境，为应用的两个重要方面建立抽象模型 【<code>profiles</code>】和【<code>properties</code>】。关于属性访问的方法通过父接口<code>PropertyResolver</code>暴露给客户端使用，本接口主要是扩展出访问【<code>profiles</code>】相关的接口。</p><p>对于他俩，这么来翻译：</p><ul><li><code>profiles</code>：配置。它代表应用在一启动时注册到context中bean definitions的命名的逻辑分组。</li><li><code>properties</code>：属性。几乎在所有应用中都扮演着重要角色，他可能源自多种源头。例如属性文件，JVM系统属性，系统环境变量，JNDI，servlet上下文参数，Map等等，<strong>Environment对象和其相关的对象</strong>一起提供给用户一个方便用来配置和解析属性的服务。</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// @since 3.1   可见Spring3.x版本是Spirng一次极其重要的跨越、升级</span>
<span class="token comment">// 它继承自PropertyResolver，所以是对属性的一个扩展~</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Environment</span> <span class="token keyword">extends</span> <span class="token class-name">PropertyResolver</span> <span class="token punctuation">{</span>
	
	<span class="token comment">// 就算被激活  也是支持同时激活多个profiles的~</span>
	<span class="token comment">// 设置的key是：spring.profiles.active</span>
	<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getActiveProfiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 默认的也可以有多个  key为：spring.profiles.default</span>
	<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getDefaultProfiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 看看传入的profiles是否是激活的~~~~  支持!表示不激活</span>
	<span class="token annotation punctuation">@Deprecated</span>
	<span class="token keyword">boolean</span> <span class="token function">acceptsProfiles</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> profiles<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// Spring5.1后提供的  用于替代上面方法   Profiles是Spring5.1才有的一个函数式接口~</span>
	<span class="token keyword">boolean</span> <span class="token function">acceptsProfiles</span><span class="token punctuation">(</span><span class="token class-name">Profiles</span> profiles<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们可以通过实现接口<code>EnvironmentAware</code>或者直接<code>@Autowired</code>可以很方便的得到当前应用的环境：<code>Environment</code>。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractEnvironment</span> <span class="token keyword">implements</span> <span class="token class-name">ConfigurableEnvironment</span> <span class="token punctuation">{</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">IGNORE_GETENV_PROPERTY_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;spring.getenv.ignore&quot;</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">ACTIVE_PROFILES_PROPERTY_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;spring.profiles.active&quot;</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEFAULT_PROFILES_PROPERTY_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;spring.profiles.default&quot;</span><span class="token punctuation">;</span>

	<span class="token comment">// 保留的默认的profile值   protected final属性，证明子类可以访问</span>
	<span class="token keyword">protected</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">RESERVED_DEFAULT_PROFILE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">;</span>


	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> activeProfiles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 显然这个里面的值 就是default这个profile了~~~~</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> defaultProfiles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token function">getReservedDefaultProfiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 这个很关键，直接new了一个 MutablePropertySources来管理属性源们</span>
	<span class="token comment">// 并且是用的PropertySourcesPropertyResolver来处理里面可能的占位符~~~~~</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">MutablePropertySources</span> propertySources <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutablePropertySources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ConfigurablePropertyResolver</span> propertyResolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PropertySourcesPropertyResolver</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>propertySources<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 唯一构造方法  customizePropertySources是空方法，交由子类去实现，对属性源进行定制~ </span>
	<span class="token comment">// Spring对属性配置分出这么多曾经，在SpringBoot中有着极其重要的意义~~~~</span>
	<span class="token keyword">public</span> <span class="token class-name">AbstractEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">customizePropertySources</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>propertySources<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 该方法，StandardEnvironment实现类是有复写的~</span>
	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">customizePropertySources</span><span class="token punctuation">(</span><span class="token class-name">MutablePropertySources</span> propertySources<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 若你想改变默认default这个值，可以复写此方法~~~~</span>
	<span class="token keyword">protected</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getReservedDefaultProfiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singleton</span><span class="token punctuation">(</span><span class="token constant">RESERVED_DEFAULT_PROFILE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">//  下面开始实现接口的方法们~~~~~~~</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getActiveProfiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">toStringArray</span><span class="token punctuation">(</span><span class="token function">doGetActiveProfiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">protected</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">doGetActiveProfiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>activeProfiles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>activeProfiles<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
		
				<span class="token comment">// 若目前是empty的，那就去获取：spring.profiles.active</span>
				<span class="token class-name">String</span> profiles <span class="token operator">=</span> <span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token constant">ACTIVE_PROFILES_PROPERTY_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>profiles<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token comment">//支持,分隔表示多个~~~且空格啥的都无所谓</span>
					<span class="token function">setActiveProfiles</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">commaDelimitedListToStringArray</span><span class="token punctuation">(</span>
							<span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">trimAllWhitespace</span><span class="token punctuation">(</span>profiles<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>activeProfiles<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>


	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setActiveProfiles</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> profiles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>activeProfiles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>activeProfiles<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 因为是set方法  所以情况已存在的吧</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> profile <span class="token operator">:</span> profiles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				 <span class="token comment">// 简单的valid，不为空且不以!打头~~~~~~~~</span>
				<span class="token function">validateProfile</span><span class="token punctuation">(</span>profile<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>activeProfiles<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>profile<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// default profiles逻辑类似，也是不能以!打头~</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token annotation punctuation">@Deprecated</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">acceptsProfiles</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> profiles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> profile <span class="token operator">:</span> profiles<span class="token punctuation">)</span> <span class="token punctuation">{</span>

			<span class="token comment">// 此处：如果该profile以!开头，那就截断出来  把后半段拿出来看看   它是否在active行列里~~~ </span>
			<span class="token comment">// 此处稍微注意：若!表示一个相反的逻辑~~~~~请注意比如!dev表示若dev是active的，我反倒是不生效的</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>profile<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> profile<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">&#39;!&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isProfileActive</span><span class="token punctuation">(</span>profile<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isProfileActive</span><span class="token punctuation">(</span>profile<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 采用函数式接口处理  就非常的优雅了~</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">acceptsProfiles</span><span class="token punctuation">(</span><span class="token class-name">Profiles</span> profiles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>profiles<span class="token punctuation">,</span> <span class="token string">&quot;Profiles must not be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> profiles<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">::</span><span class="token function">isProfileActive</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 简答的说要么active包含，要门是default  这个profile就被认为是激活的</span>
	<span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">isProfileActive</span><span class="token punctuation">(</span><span class="token class-name">String</span> profile<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">validateProfile</span><span class="token punctuation">(</span>profile<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> currentActiveProfiles <span class="token operator">=</span> <span class="token function">doGetActiveProfiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span>currentActiveProfiles<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>profile<span class="token punctuation">)</span> <span class="token operator">||</span>
				<span class="token punctuation">(</span>currentActiveProfiles<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">doGetDefaultProfiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>profile<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">MutablePropertySources</span> <span class="token function">getPropertySources</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>propertySources<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">getSystemProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">getSystemEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 这个判断为：return SpringProperties.getFlag(IGNORE_GETENV_PROPERTY_NAME);</span>
		<span class="token comment">// 所以我们是可以通过在`spring.properties`这个配置文件里spring.getenv.ignore=false关掉不暴露环境变量的~~~</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">suppressGetenvAccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptyMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Append the given parent environment&#39;s active profiles, default profiles and property sources to this (child) environment&#39;s respective collections of each.</span>
	<span class="token comment">// 把父环境的属性合并进来~~~~  </span>
	<span class="token comment">// 在调用ApplicationContext.setParent方法时，会把父容器的环境合并进来  以保证父容器的属性对子容器都是可见的</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableEnvironment</span> parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">PropertySource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> ps <span class="token operator">:</span> parent<span class="token punctuation">.</span><span class="token function">getPropertySources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>propertySources<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>ps<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>propertySources<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span>ps<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 父容器的属性都放在最末尾~~~~</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 合并active</span>
		<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> parentActiveProfiles <span class="token operator">=</span> parent<span class="token punctuation">.</span><span class="token function">getActiveProfiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">ObjectUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>parentActiveProfiles<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>activeProfiles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> profile <span class="token operator">:</span> parentActiveProfiles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>activeProfiles<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>profile<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 合并default</span>
		<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> parentDefaultProfiles <span class="token operator">=</span> parent<span class="token punctuation">.</span><span class="token function">getDefaultProfiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">ObjectUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>parentDefaultProfiles<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>defaultProfiles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>defaultProfiles<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token constant">RESERVED_DEFAULT_PROFILE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> profile <span class="token operator">:</span> parentDefaultProfiles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>defaultProfiles<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>profile<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 其余方法全部委托给内置的propertyResolver属性，因为它就是个`PropertyResolver`</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>web相关配置的属性源的优先级是高于system相关的。若使用<code>@PropertySource</code>导入自定义配置，它会位于最底端（<strong>优先级最低</strong>）</p><h3 id="value" tabindex="-1"><a class="header-anchor" href="#value" aria-hidden="true">#</a> @Value</h3><p>支持功能：</p><ul><li>直接注入属性</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>  <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;normal&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>注入操作系统属性</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>	<span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${os.name}&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>注入表达式结果</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>	<span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;#{ T(java.lang.Math).random() * 100.0 }&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>注入其他Bean的属性</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>  <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;#{person.name}&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>注入文件资源</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>  <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:jdbc.properties&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>注入URL资源</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>  <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;http://www.baidu.com&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">private</span> <span class="token class-name">Resource</span> testUrl<span class="token punctuation">;</span> <span class="token comment">// 注入URL资源</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="数据转换" tabindex="-1"><a class="header-anchor" href="#数据转换" aria-hidden="true">#</a> 数据转换</h2><figure><img src="https://raw.githubusercontent.com/nocetfy/image/main/img/uzc36vlf0q.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="propertyeditor" tabindex="-1"><a class="header-anchor" href="#propertyeditor" aria-hidden="true">#</a> PropertyEditor</h3><p>早期的Spirng（3.0之前）类型转换是基于Java Beans接口<code>java.beans.PropertyEditor</code>来实现的（全部继承自<code>PropertyEditorSupport</code>）：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PropertyEditor</span> <span class="token punctuation">{</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token comment">// String -&gt; Object</span>
	<span class="token keyword">void</span> <span class="token function">setAsText</span><span class="token punctuation">(</span><span class="token class-name">String</span> text<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>IllegalArgumentException</span><span class="token punctuation">;</span>
	<span class="token comment">// Object -&gt; String</span>
	<span class="token class-name">String</span> <span class="token function">getAsText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这类实现举例有：</p><ul><li><code>StringArrayPropertyEditor</code>：<code>,</code>分隔的字符串和<code>String[]</code>类型互转</li><li><code>PropertiesEditor</code>：键值对字符串和<code>Properties</code>类型互转</li><li><code>IntegerEditor</code>：字符串和<code>Integer</code>类型互转</li><li>...</li></ul><p>​ 基于<code>PropertyEditor</code>的类型转换作为一种古老的、遗留下来的方式，是具有一些设计缺陷的，如：职责不单一，类型不安全，只能实现<code>String</code>类型的转换等。虽然自Spring 3.0起提供了现代化的类型转换接口，但是此部分机制一直得以<strong>保留</strong>，保证了向下兼容性。</p><h3 id="converter、genericconverter" tabindex="-1"><a class="header-anchor" href="#converter、genericconverter" aria-hidden="true">#</a> Converter、GenericConverter</h3><p>为了解决<code>PropertyEditor</code>作为类型转换方式的设计缺陷，Spring 3.0版本重新设计了一套类型转换接口，其中主要包括：</p><h4 id="converter-s-t" tabindex="-1"><a class="header-anchor" href="#converter-s-t" aria-hidden="true">#</a> Converter&lt;S, T&gt;</h4><p>Source -&gt; Target类型转换接口，适用于1:1转换</p><ul><li><code>StringToPropertiesConverter</code>：将String类型转换为Properties</li><li><code>StringToBooleanConverter</code>：将String类型转换为Boolean</li><li><code>EnumToIntegerConverter</code>：将Enum类型转换为Integer</li></ul><h4 id="converterfactory-s-r" tabindex="-1"><a class="header-anchor" href="#converterfactory-s-r" aria-hidden="true">#</a> ConverterFactory&lt;S, R&gt;</h4><p>Source -&gt; R类型转换接口，适用于1:N转换</p><ul><li><code>StringToEnumConverterFactory</code>：将String类型转任意Enum</li><li><code>StringToNumberConverterFactory</code>：将String类型转为任意数字（可以是int、long、double等等）</li><li><code>NumberToNumberConverterFactory</code>：数字类型转为数字类型（如int到long，long到double等等）</li></ul><h4 id="genericconverter" tabindex="-1"><a class="header-anchor" href="#genericconverter" aria-hidden="true">#</a> GenericConverter</h4><p>更为通用的类型转换接口，适用于N:N转换</p><ul><li><code>ObjectToCollectionConverter</code>：任意集合类型转为任意集合类型（如<code>List&lt;String&gt;</code>转为<code>List&lt;Integer&gt; / Set&lt;Integer&gt;</code>都使用此转换器</li><li><code>CollectionToArrayConverter</code>：解释基本同上</li><li><code>MapToMapConverter</code>：解释基本同上</li></ul><h4 id="conditionalconverter" tabindex="-1"><a class="header-anchor" href="#conditionalconverter" aria-hidden="true">#</a> ConditionalConverter</h4><p>条件转换接口。可跟上面3个接口组合使用，提供<strong>前置条件</strong>判断验证。</p><p>​ 重新设计的这套接口，解决了<code>PropertyEditor</code>做类型转换存在的所有缺陷，且具有非常高的灵活性和可扩展性。但是，每个接口独立来看均具有一定的局限性，只有使用<strong>组合拳</strong>方才有最大威力。</p><h3 id="conversionservice" tabindex="-1"><a class="header-anchor" href="#conversionservice" aria-hidden="true">#</a> ConversionService</h3><p>​ 新的这套接口中，<code>Converter、ConverterFactory、GenericConverter</code>它们三都着力于完成类型转换。对于使用者而言，如果做个类型转换需要了解到这三套体系无疑成本太高，因此就有了<code>ConversionService</code>用于整合它们三，统一化接口操作。</p><p>此接口也是Spring 3.0新增，用于<strong>统一化</strong> 底层类型转换实现的差异，对外提供统一服务，所以它也被称作类型转换的<strong>门面接口</strong>，从接口名称<code>xxxService</code>也能看出来其设计思路。它主要有两大实现：</p><ol><li><code>GenericConversionService</code>：提供模版实现，如转换器的注册、删除、匹配查找等，但并不内置转换器实现</li><li><code>DefaultConversionService</code>：继承自GenericConversionService。在它基础上默认注册了非常多的内建的转换器实现，从而能够实现<strong>绝大部分</strong>的类型转换需求</li></ol><p>​ <code>ConversionService</code>转换服务它贯穿于Spring上下文<code>ApplicationContext</code>的多项功能，包括但不限于：BeanWrapper处理Bean属性、DataBinder数据绑定、PropertySource外部化属性处理等等。</p><h3 id="typeconvert" tabindex="-1"><a class="header-anchor" href="#typeconvert" aria-hidden="true">#</a> TypeConvert</h3><p>​ 定义类型转换方法的接口，它在Spring 2.0就已经存在。在还没有<code>ConversionService</code>之前，它的类型转换动作均委托给已注册的<code>PropertyEditor</code>来完成。但自3.0之后，这个转换动作可能被PropertyEditor来做，也可能交给<code>ConversionService</code>处理。</p><p>它一共提供三个重载方法：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// @since 2.0</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TypeConverter</span> <span class="token punctuation">{</span>

 	<span class="token comment">// value：待转换的source源数据</span>
 	<span class="token comment">// requiredType：目标类型targetType</span>
 	<span class="token comment">// methodParam：转换的目标方法参数，主要为了分析泛型类型，可能为null</span>
 	<span class="token comment">// field：目标的反射字段，为了泛型，可能为null</span>
	<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">convertIfNecessary</span><span class="token punctuation">(</span><span class="token class-name">Object</span> value<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> requiredType<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">TypeMismatchException</span><span class="token punctuation">;</span>
	<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">convertIfNecessary</span><span class="token punctuation">(</span><span class="token class-name">Object</span> value<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> requiredType<span class="token punctuation">,</span> <span class="token class-name">MethodParameter</span> methodParam<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">TypeMismatchException</span><span class="token punctuation">;</span>
	<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">convertIfNecessary</span><span class="token punctuation">(</span><span class="token class-name">Object</span> value<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> requiredType<span class="token punctuation">,</span> <span class="token class-name">Field</span> field<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">TypeMismatchException</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>它是Spring内部使用类型转换的<strong>入口</strong>，最终委托给<code>PropertyEditor</code>或者注册到<code>ConversionService</code>里的转换器去完成。它的主要实现有：</p><ul><li><code>TypeConverterSupport</code>：@since 3.2。继承自<code>PropertyEditorRegistrySupport</code>，它主要是为子类<code>BeanWrapperImpl</code>提供功能支撑。作用有如下两方面：</li></ul><blockquote><ol><li><p>提供对<strong>默认编辑器</strong>（支持JDK内置类型的转换如：Charset、Class、Class[]、Properties、Collection等等）和<strong>自定义编辑器</strong>的管理（PropertyEditorRegistry#registerCustomEditor）</p></li><li><p>提供get/set方法，把<code>ConversionService</code>管理上（可选依赖，可为null）</p></li></ol></blockquote><ul><li>数据绑定相关：因为数据绑定<strong>强依赖于</strong>类型转换，因此数据绑定涉及到的属性访问操作将会依赖于此组件，不管是直接访问属性的<code>DirectFieldAccessor</code>还是功能更强大的<code>BeanWrapperImpl</code>均是如此</li></ul><p>总的来说，<code>TypeConverter</code>能把类型的各种实现、API收口于此，Spring把类型转换的能力都转嫁到TypeConverter这个API里面去了。</p><hr><h2 id="数据绑定" tabindex="-1"><a class="header-anchor" href="#数据绑定" aria-hidden="true">#</a> 数据绑定</h2><h3 id="propertyaccessor" tabindex="-1"><a class="header-anchor" href="#propertyaccessor" aria-hidden="true">#</a> PropertyAccessor</h3><p>​ 它是可以访问命名属性<code>named properties</code>（例如对象的bean属性或对象中的字段）的类的公共接口。大名鼎鼎的<code>BeanWrapper</code>接口也继承自它，它所在包是<code>org.springframework.beans</code>（<code>BeanWrapper</code>也在此包）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// @since 1.1  出现得非常早</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PropertyAccessor</span> <span class="token punctuation">{</span>

	<span class="token comment">// 简单的说就是级联属性的分隔符。</span>
	<span class="token comment">// 比如foo.bar最终会调用getFoo().getBar()两个方法</span>
	<span class="token class-name">String</span> <span class="token constant">NESTED_PROPERTY_SEPARATOR</span> <span class="token operator">=</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> <span class="token constant">NESTED_PROPERTY_SEPARATOR_CHAR</span> <span class="token operator">=</span> <span class="token char">&#39;.&#39;</span><span class="token punctuation">;</span>

	<span class="token comment">// 代表角标index的符号  如person.addresses[0]  这样就可以把值放进集合/数组/Map里了</span>
	<span class="token class-name">String</span> <span class="token constant">PROPERTY_KEY_PREFIX</span> <span class="token operator">=</span> <span class="token string">&quot;[&quot;</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> <span class="token constant">PROPERTY_KEY_PREFIX_CHAR</span> <span class="token operator">=</span> <span class="token char">&#39;[&#39;</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> <span class="token constant">PROPERTY_KEY_SUFFIX</span> <span class="token operator">=</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> <span class="token constant">PROPERTY_KEY_SUFFIX_CHAR</span> <span class="token operator">=</span> <span class="token char">&#39;]&#39;</span><span class="token punctuation">;</span>


	<span class="token comment">// 此属性是否可读。若属性不存在  返回false</span>
	<span class="token keyword">boolean</span> <span class="token function">isReadableProperty</span><span class="token punctuation">(</span><span class="token class-name">String</span> propertyName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 此出行是否可写。若属性不存在，返回false</span>
	<span class="token keyword">boolean</span> <span class="token function">isWritableProperty</span><span class="token punctuation">(</span><span class="token class-name">String</span> propertyName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	

	<span class="token comment">// 读方法</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">getPropertyType</span><span class="token punctuation">(</span><span class="token class-name">String</span> propertyName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token class-name">TypeDescriptor</span> <span class="token function">getPropertyTypeDescriptor</span><span class="token punctuation">(</span><span class="token class-name">String</span> propertyName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token class-name">Object</span> <span class="token function">getPropertyValue</span><span class="token punctuation">(</span><span class="token class-name">String</span> propertyName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">;</span>

	<span class="token comment">// 写方法  </span>
	<span class="token keyword">void</span> <span class="token function">setPropertyValue</span><span class="token punctuation">(</span><span class="token class-name">String</span> propertyName<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">setPropertyValue</span><span class="token punctuation">(</span><span class="token class-name">PropertyValue</span> pv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">;</span>
	<span class="token comment">// 批量设置值</span>
	<span class="token keyword">void</span> <span class="token function">setPropertyValues</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">;</span>
	<span class="token comment">// 说明：PropertyValues和PropertyValue关系特别像PropertySources和PropertySource的关系</span>
	<span class="token keyword">void</span> <span class="token function">setPropertyValues</span><span class="token punctuation">(</span><span class="token class-name">PropertyValues</span> pvs<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">;</span>

	<span class="token comment">// 可控制是否接受非法的字段、value值扽  ignoreUnknown/ignoreInvalid分别对应非法属性和非法value值的处理策略~</span>
	<span class="token keyword">void</span> <span class="token function">setPropertyValues</span><span class="token punctuation">(</span><span class="token class-name">PropertyValues</span> pvs<span class="token punctuation">,</span> <span class="token keyword">boolean</span> ignoreUnknown<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">setPropertyValues</span><span class="token punctuation">(</span><span class="token class-name">PropertyValues</span> pvs<span class="token punctuation">,</span> <span class="token keyword">boolean</span> ignoreUnknown<span class="token punctuation">,</span> <span class="token keyword">boolean</span> ignoreInvalid<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="directfieldaccessor" tabindex="-1"><a class="header-anchor" href="#directfieldaccessor" aria-hidden="true">#</a> DirectFieldAccessor</h4><p>它继承自<code>AbstractNestablePropertyAccessor</code>，所以它肯定也就可以处理级联属性和集合数组值了。（<strong>请注意，在Spring4.2之后支持，之前是不支持的~</strong>）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// @since 2.0   出现得可比父类`AbstractNestablePropertyAccessor`要早哦~~~注意：父类的构造函数都是protected的</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DirectFieldAccessor</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractNestablePropertyAccessor</span> <span class="token punctuation">{</span>

	<span class="token comment">// 缓存着每个字段的处理器FieldPropertyHandler</span>
	<span class="token comment">// ReflectionUtils.findField()根据String去找到Field对象的</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">FieldPropertyHandler</span><span class="token punctuation">&gt;</span></span> fieldMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">DirectFieldAccessor</span><span class="token punctuation">(</span><span class="token class-name">Object</span> object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 这个构造器也是protected 的  所以若你想自己指定nestedPath和parent，你可以继承此类~~~</span>
	<span class="token keyword">protected</span> <span class="token class-name">DirectFieldAccessor</span><span class="token punctuation">(</span><span class="token class-name">Object</span> object<span class="token punctuation">,</span> <span class="token class-name">String</span> nestedPath<span class="token punctuation">,</span> <span class="token class-name">DirectFieldAccessor</span> parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> nestedPath<span class="token punctuation">,</span> parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

	<span class="token comment">// 实现父类的抽象方法，依旧使用DirectFieldAccessor去处理~~~</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">protected</span> <span class="token class-name">DirectFieldAccessor</span> <span class="token function">newNestedPropertyAccessor</span><span class="token punctuation">(</span><span class="token class-name">Object</span> object<span class="token punctuation">,</span> <span class="token class-name">String</span> nestedPath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DirectFieldAccessor</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> nestedPath<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 字段field属性处理器，使用内部类实现PropertyHandler ~~~</span>
	<span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">FieldPropertyHandler</span> <span class="token keyword">extends</span> <span class="token class-name">PropertyHandler</span> <span class="token punctuation">{</span>
		<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Field</span> field<span class="token punctuation">;</span>
		<span class="token comment">// 从此处可以看出`DirectFieldAccessor`里的field默认都是可读、可写的~~~~</span>
		<span class="token keyword">public</span> <span class="token class-name">FieldPropertyHandler</span><span class="token punctuation">(</span><span class="token class-name">Field</span> field<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">super</span><span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>field <span class="token operator">=</span> field<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="demo" tabindex="-1"><a class="header-anchor" href="#demo" aria-hidden="true">#</a> demo</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ToString</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Apple</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> color<span class="token punctuation">;</span>

    <span class="token comment">// 复杂类型</span>
    <span class="token keyword">private</span> <span class="token class-name">Size</span> size <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 苹果的尺寸。 存在级联</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arrStr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> listStr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 更为复杂的类型</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> listList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> listMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Apple</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        listList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        listMap<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token annotation punctuation">@ToString</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Size</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> height<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> width<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>类<code>Apple</code>属性丰富，<strong>并且统一都没有提供get/set方法</strong>。使用<code>DirectFieldAccessor</code>直接的属性访问器给其赋值：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Apple</span> apple <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Apple</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">PropertyAccessor</span> accessor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DirectFieldAccessor</span><span class="token punctuation">(</span>apple<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 设置普通属性</span>
        accessor<span class="token punctuation">.</span><span class="token function">setPropertyValue</span><span class="token punctuation">(</span><span class="token string">&quot;color&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;红色&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 设置嵌套属性（注意：此处能够正常work是因为有= new Size()，</span>
        <span class="token comment">// 否则报错：Value of nested property &#39;size&#39; is null 下同~）</span>
        accessor<span class="token punctuation">.</span><span class="token function">setPropertyValue</span><span class="token punctuation">(</span><span class="token string">&quot;size.height&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 设置集合/数组属性</span>
        accessor<span class="token punctuation">.</span><span class="token function">setPropertyValue</span><span class="token punctuation">(</span><span class="token string">&quot;arrStr[0]&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;arrStr&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        accessor<span class="token punctuation">.</span><span class="token function">setPropertyValue</span><span class="token punctuation">(</span><span class="token string">&quot;arrStr[1]&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;arrStr1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注意：虽然初始化时初始化过数组了，但是仍以此处的为准</span>
        accessor<span class="token punctuation">.</span><span class="token function">setPropertyValue</span><span class="token punctuation">(</span><span class="token string">&quot;listStr[0]&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;listStr&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        accessor<span class="token punctuation">.</span><span class="token function">setPropertyValue</span><span class="token punctuation">(</span><span class="token string">&quot;listStr[0]&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;listStr1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 如果角标index一样，后面覆盖前面的</span>
        <span class="token comment">// 虽然listStr是String的List，但是反射绕过了泛型  可以set进去，但一get就报错~~~需要注意这一点</span>
        <span class="token comment">//accessor.setPropertyValue(&quot;listStr[0]&quot;, new Size());</span>
        <span class="token comment">//accessor.setPropertyValue(&quot;listStr[1]&quot;, 20);</span>
        <span class="token comment">//System.out.println(apple.getListStr().get(0)); //Cannot convert value of type &#39;com.fsx.bean.Size&#39; to required type &#39;java.lang.String&#39;</span>


        <span class="token comment">// 设置Map：key只能是数值才行，否则是不好使的~~~~</span>
        <span class="token comment">//accessor.setPropertyValue(&quot;map[&#39;aaa&#39;]&quot;,&quot;myValue1&quot;); //Caused by: java.lang.NumberFormatException: For input string: &quot;aaa&quot;</span>
        accessor<span class="token punctuation">.</span><span class="token function">setPropertyValue</span><span class="token punctuation">(</span><span class="token string">&quot;map[1]&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;myValue2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 设置listList这种集合里的集合</span>
        accessor<span class="token punctuation">.</span><span class="token function">setPropertyValue</span><span class="token punctuation">(</span><span class="token string">&quot;listList[0][0]&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;listList00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        accessor<span class="token punctuation">.</span><span class="token function">setPropertyValue</span><span class="token punctuation">(</span><span class="token string">&quot;listList[0][1]&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;listList01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//accessor.setPropertyValue(&quot;listList[1][0]&quot;,&quot;listList10&quot;); //IndexOutOfBoundsException: Index: 1, Size: 1</span>
        <span class="token comment">//accessor.setPropertyValue(&quot;listList[1][1]&quot;,&quot;listList11&quot;); //IndexOutOfBoundsException: Index: 1, Size: 1</span>

        <span class="token comment">// 设置listMap这种集合里面放Map</span>
        accessor<span class="token punctuation">.</span><span class="token function">setPropertyValue</span><span class="token punctuation">(</span><span class="token string">&quot;listMap[0][0]&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;listMap00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//accessor.setPropertyValue(&quot;listMap[0][&#39;myKey&#39;]&quot;,&quot;listMapkey&quot;); //For input string: &quot;myKey&quot;</span>


        <span class="token comment">// =========打印输出</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>apple<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Apple(color=红色, size=Size(height=10, width=null), arrStr=[arrStr, arrStr1], listStr=[listStr1], map={1=myValue2}, listList=[[listList00, listList01]], listMap=[{0=listMap00}])</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从结果中是能够看出来的，使用<code>DirectFieldAccessor</code>能够正确完成属性赋值。这使用<code>DirectFieldAccessor</code>作为实现的话有几点使用小细节需要注意：</p><ol><li>若是级联属性、集合数组等复杂属性，<strong>初始值不能为null</strong></li><li>使用它给属性赋值无序提供get、set方法（<strong>侧面意思是：它不会走你的get/set方法逻辑</strong>）</li></ol><blockquote><p>​ 当然若你希望null值能够被自动初始化也是可以的，请设值：<code>accessor.setAutoGrowNestedPaths(true);</code>这样数组、集合、Map等都会为null时候给你初始化(其它Bean请保证有默认构造函数)</p></blockquote><p>在实际开发中，<code>DirectFieldAccessor</code>使用的场景相对较少，但有个典型应用是<code>Spring-Data-Redis</code>有使用<code>DirectFieldAccessor</code>来获取属性值</p><blockquote><p>若我们开发中只是单纯的想<code>直接</code>获取属性值，不妨可以使用它，形如这样：<code>new DirectFieldAccessor(client).getPropertyValue(&quot;redisURI&quot;)</code>非常的方便</p></blockquote><hr><h3 id="beanwrapper" tabindex="-1"><a class="header-anchor" href="#beanwrapper" aria-hidden="true">#</a> BeanWrapper</h3><p><code>BeanWrapper</code>可以简单的把它理解为：一个方便开发人员<strong>使用字符串</strong>来对<code>Java Bean</code>的属性执行get、set操作的工具。关于它的数据转换使用了如下两种机制：</p><ol><li><code>PropertyEditor</code>：隶属于<strong>Java Bean规范</strong>。<code>PropertyEditor</code>只提供了<code>String &lt;-&gt; Object</code>的转换。</li><li><code>ConversionService</code>：Spring自3.0之后提供的替代PropertyEditor的机制（<code>BeanWrapper</code>在Spring的第一个版本就存在了）</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//@since 13 April 2001  很清晰的看到，它也是个`PropertyAccessor`属性访问器</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BeanWrapper</span> <span class="token keyword">extends</span> <span class="token class-name">ConfigurablePropertyAccessor</span> <span class="token punctuation">{</span>

	<span class="token comment">// @since 4.1</span>
	<span class="token keyword">void</span> <span class="token function">setAutoGrowCollectionLimit</span><span class="token punctuation">(</span><span class="token keyword">int</span> autoGrowCollectionLimit<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> <span class="token function">getAutoGrowCollectionLimit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


	<span class="token class-name">Object</span> <span class="token function">getWrappedInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">getWrappedClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 获取属性们的PropertyDescriptor  获取属性们</span>
	<span class="token class-name">PropertyDescriptor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getPropertyDescriptors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 获取具体某一个属性~</span>
	<span class="token class-name">PropertyDescriptor</span> <span class="token function">getPropertyDescriptor</span><span class="token punctuation">(</span><span class="token class-name">String</span> propertyName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InvalidPropertyException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>BeanWrapper相当于一个代理器，Spring委托<code>BeanWrapper</code>完成Bean属性的填充工作。关于此接口的实现类，简单的说它只有唯一实现类：<code>BeanWrapperImpl</code></p><h4 id="beanwrapperimpl" tabindex="-1"><a class="header-anchor" href="#beanwrapperimpl" aria-hidden="true">#</a> BeanWrapperImpl</h4><p>它作为<code>BeanWrapper</code>接口的默认实现，它足以满足所有的典型应用场景，它会缓存Bean的内省结果而提高效率。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeanWrapperImpl</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractNestablePropertyAccessor</span> <span class="token keyword">implements</span> <span class="token class-name">BeanWrapper</span> <span class="token punctuation">{</span>

	<span class="token comment">// 缓存内省结果~</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token keyword">private</span> <span class="token class-name">CachedIntrospectionResults</span> cachedIntrospectionResults<span class="token punctuation">;</span>
	<span class="token comment">// The security context used for invoking the property methods.</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token keyword">private</span> <span class="token class-name">AccessControlContext</span> acc<span class="token punctuation">;</span>

	<span class="token comment">// 构造方法都是沿用父类的~</span>
	<span class="token keyword">public</span> <span class="token class-name">BeanWrapperImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 
	<span class="token keyword">private</span> <span class="token class-name">BeanWrapperImpl</span><span class="token punctuation">(</span><span class="token class-name">Object</span> object<span class="token punctuation">,</span> <span class="token class-name">String</span> nestedPath<span class="token punctuation">,</span> <span class="token class-name">BeanWrapperImpl</span> parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> nestedPath<span class="token punctuation">,</span> parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">setSecurityContext</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>acc<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>


	<span class="token comment">// @since 4.3  设置目标对象~~~</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBeanInstance</span><span class="token punctuation">(</span><span class="token class-name">Object</span> object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>wrappedObject <span class="token operator">=</span> object<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>rootObject <span class="token operator">=</span> object<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>typeConverterDelegate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TypeConverterDelegate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>wrappedObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 设置内省的clazz</span>
		<span class="token function">setIntrospectionClass</span><span class="token punctuation">(</span>object<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 复写父类的方法  增加内省逻辑</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setWrappedInstance</span><span class="token punctuation">(</span><span class="token class-name">Object</span> object<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> nestedPath<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> rootObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">setWrappedInstance</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> nestedPath<span class="token punctuation">,</span> rootObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">setIntrospectionClass</span><span class="token punctuation">(</span><span class="token function">getWrappedClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 如果cachedIntrospectionResults它持有的BeanClass并不是传入的clazz 那就清空缓存 重新来~~~</span>
	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">setIntrospectionClass</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cachedIntrospectionResults <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cachedIntrospectionResults<span class="token punctuation">.</span><span class="token function">getBeanClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> clazz<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>cachedIntrospectionResults <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">private</span> <span class="token class-name">CachedIntrospectionResults</span> <span class="token function">getCachedIntrospectionResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cachedIntrospectionResults <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// forClass此方法：生成此clazz的类型结果，并且缓存了起来~~</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>cachedIntrospectionResults <span class="token operator">=</span> <span class="token class-name">CachedIntrospectionResults</span><span class="token punctuation">.</span><span class="token function">forClass</span><span class="token punctuation">(</span><span class="token function">getWrappedClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cachedIntrospectionResults<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

	<span class="token comment">// 获取到此属性的处理器。此处是个BeanPropertyHandler 内部类~</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token keyword">protected</span> <span class="token class-name">BeanPropertyHandler</span> <span class="token function">getLocalPropertyHandler</span><span class="token punctuation">(</span><span class="token class-name">String</span> propertyName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">PropertyDescriptor</span> pd <span class="token operator">=</span> <span class="token function">getCachedIntrospectionResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPropertyDescriptor</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span>pd <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">BeanPropertyHandler</span><span class="token punctuation">(</span>pd<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">protected</span> <span class="token class-name">BeanWrapperImpl</span> <span class="token function">newNestedPropertyAccessor</span><span class="token punctuation">(</span><span class="token class-name">Object</span> object<span class="token punctuation">,</span> <span class="token class-name">String</span> nestedPath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BeanWrapperImpl</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> nestedPath<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">PropertyDescriptor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getPropertyDescriptors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token function">getCachedIntrospectionResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPropertyDescriptors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 获取具体某一个属性的PropertyDescriptor </span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">PropertyDescriptor</span> <span class="token function">getPropertyDescriptor</span><span class="token punctuation">(</span><span class="token class-name">String</span> propertyName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InvalidPropertyException</span> <span class="token punctuation">{</span>
		<span class="token class-name">BeanWrapperImpl</span> nestedBw <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">BeanWrapperImpl</span><span class="token punctuation">)</span> <span class="token function">getPropertyAccessorForPropertyPath</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> finalPath <span class="token operator">=</span> <span class="token function">getFinalPath</span><span class="token punctuation">(</span>nestedBw<span class="token punctuation">,</span> propertyName<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">PropertyDescriptor</span> pd <span class="token operator">=</span> nestedBw<span class="token punctuation">.</span><span class="token function">getCachedIntrospectionResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPropertyDescriptor</span><span class="token punctuation">(</span>finalPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pd <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InvalidPropertyException</span><span class="token punctuation">(</span><span class="token function">getRootClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getNestedPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> propertyName<span class="token punctuation">,</span> <span class="token string">&quot;No property &#39;&quot;</span> <span class="token operator">+</span> propertyName <span class="token operator">+</span> <span class="token string">&quot;&#39; found&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> pd<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

	<span class="token comment">// 此处理器处理的是PropertyDescriptor </span>
	<span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">BeanPropertyHandler</span> <span class="token keyword">extends</span> <span class="token class-name">PropertyHandler</span> <span class="token punctuation">{</span>
		<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">PropertyDescriptor</span> pd<span class="token punctuation">;</span>

		<span class="token comment">// 是否可读、可写  都是由PropertyDescriptor 去决定了~</span>
		<span class="token comment">// java.beans.PropertyDescriptor~~</span>
		<span class="token keyword">public</span> <span class="token class-name">BeanPropertyHandler</span><span class="token punctuation">(</span><span class="token class-name">PropertyDescriptor</span> pd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">super</span><span class="token punctuation">(</span>pd<span class="token punctuation">.</span><span class="token function">getPropertyType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pd<span class="token punctuation">.</span><span class="token function">getReadMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> pd<span class="token punctuation">.</span><span class="token function">getWriteMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>pd <span class="token operator">=</span> pd<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
		<span class="token annotation punctuation">@Override</span>
		<span class="token annotation punctuation">@Nullable</span>
		<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
			<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
			<span class="token class-name">ReflectionUtils</span><span class="token punctuation">.</span><span class="token function">makeAccessible</span><span class="token punctuation">(</span>readMethod<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> readMethod<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token function">getWrappedInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从继承体系上，首先我们应该能看出来<code>BeanWrapperImpl</code>的三重身份：</p><ol><li><strong>Bean包裹器</strong></li><li>属性访问器（PropertyAccessor）</li><li>属性编辑器注册表（PropertyEditorRegistry）</li></ol><p>从源码中继续分析还能再得出如下两个结论：</p><ol><li>它给属性赋值调用的是Method方法，如<code>readMethod.invoke</code>和<code>writeMethod.invoke</code></li><li>它对Bean的操作，大都委托给<code>CachedIntrospectionResults</code>去完成~</li></ol><h4 id="demo-1" tabindex="-1"><a class="header-anchor" href="#demo-1" aria-hidden="true">#</a> demo</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 省略Apple类和Size类，有需要的请参照上篇文章（加上@Getter、@Setter即可</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Apple</span> apple <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Apple</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">BeanWrapper</span> beanWrapper <span class="token operator">=</span> <span class="token class-name">PropertyAccessorFactory</span><span class="token punctuation">.</span><span class="token function">forBeanPropertyAccess</span><span class="token punctuation">(</span>apple<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ================当作一个普通的PropertyAccessor来使用  默认情况下字段也都必须有初始值才行~===================</span>
        <span class="token comment">// 设置普通属性</span>
        beanWrapper<span class="token punctuation">.</span><span class="token function">setPropertyValue</span><span class="token punctuation">(</span><span class="token string">&quot;color&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;红色&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//请保证对应字段有set方法才行，否则抛错：Does the parameter type of the setter match the return type of the getter?</span>
        <span class="token comment">// 设置嵌套属性（注意：此处能够正常work是因为有= new Size()，</span>
        <span class="token comment">// 否则报错：Value of nested property &#39;size&#39; is null 下同~）</span>
        beanWrapper<span class="token punctuation">.</span><span class="token function">setPropertyValue</span><span class="token punctuation">(</span><span class="token string">&quot;size.height&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 设置集合/数组属性</span>
        beanWrapper<span class="token punctuation">.</span><span class="token function">setPropertyValue</span><span class="token punctuation">(</span><span class="token string">&quot;arrStr[0]&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;arrStr&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        beanWrapper<span class="token punctuation">.</span><span class="token function">setPropertyValue</span><span class="token punctuation">(</span><span class="token string">&quot;arrStr[1]&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;arrStr1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注意：虽然初始化时初始化过数组了，但是仍以此处的为准</span>
        <span class="token comment">// =========打印输出</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>apple<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Apple(color=红色, size=Size(height=10, width=null), arrStr=[arrStr, arrStr1], listStr=[], map={}, listList=[[]], listMap=[{}])</span>


        <span class="token comment">// 当作BeanWrapper使用</span>
        <span class="token class-name">PropertyDescriptor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> propertyDescriptors <span class="token operator">=</span> beanWrapper<span class="token punctuation">.</span><span class="token function">getPropertyDescriptors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PropertyDescriptor</span> color <span class="token operator">=</span> beanWrapper<span class="token punctuation">.</span><span class="token function">getPropertyDescriptor</span><span class="token punctuation">(</span><span class="token string">&quot;color&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>propertyDescriptors<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 8</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//org.springframework.beans.GenericTypeAwarePropertyDescriptor[name=color]</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>beanWrapper<span class="token punctuation">.</span><span class="token function">getWrappedClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//class com.fsx.bean.Apple</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>beanWrapper<span class="token punctuation">.</span><span class="token function">getWrappedInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Apple(color=红色, size=Size(height=10...</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ioc结合内省与beanwrapper" tabindex="-1"><a class="header-anchor" href="#ioc结合内省与beanwrapper" aria-hidden="true">#</a> IOC结合内省与BeanWrapper</h4><p>​ Spring需要依赖注入就需要使用<code>BeanWrapper</code>，上章节说了<code>BeanWrapperImpl</code>的实现大都委托给了<code>CachedIntrospectionResults</code>去完成，而<code>CachedIntrospectionResults</code>它的核心说法就是<strong>Java内省机制</strong>。从层层委托的依赖关系可以看出，<code>Spring IoC</code>的依赖注入（给属性赋值）是层层委托的最终给了Java内省机制，这是Spring框架设计精妙处之一。这也符合我上文所诉：<code>BeanWrapper</code><strong>这个接口并不建议应用自己去直接使用</strong></p><figure><img src="https://raw.githubusercontent.com/nocetfy/image/main/img/image-20231105164428250.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h5 id="docreatebean-创建bean" tabindex="-1"><a class="header-anchor" href="#docreatebean-创建bean" aria-hidden="true">#</a> doCreateBean() 创建Bean</h5><p>任何创建Bean的过程，都得经历<code>doCreateBean()</code>。这句代码我们已经非常熟悉了，它在<code>AbstractAutowireCapableBeanFactory</code>里：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>	<span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">doCreateBean</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">RootBeanDefinition</span> mbd<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeanCreationException</span> <span class="token punctuation">{</span>
		<span class="token class-name">BeanWrapper</span> instanceWrapper <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
		<span class="token comment">// 这一步简单的说：通过构造函数实例化Bean后，new BeanWrapperImpl(beanInstance)包装起来</span>
		<span class="token comment">// 并且：initBeanWrapper(bw);  作用是注册ConversionService和registerCustomEditors() ...</span>
		instanceWrapper <span class="token operator">=</span> <span class="token function">createBeanInstance</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
		<span class="token comment">// 给属性赋值：此处会实施BeanWrapper的真正实力~~~~</span>
		<span class="token comment">// 注意：此处第三个参数传入的是BeanWrapper，而不是源生beanduixiang~~~ </span>
		<span class="token function">populateBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> instanceWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
		exposedObject <span class="token operator">=</span> <span class="token function">initializeBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> exposedObject<span class="token punctuation">,</span> mbd<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ <code>doCreateBean</code>这个方法完成整个Bean的实例化、初始化。而这里面我们最为关注的自然就是<code>populateBean()</code>这个方法，它的作用是完成给属性赋值，从时序图中也可以看出这是一个入口</p><h5 id="populatebean-给bean的属性赋值" tabindex="-1"><a class="header-anchor" href="#populatebean-给bean的属性赋值" aria-hidden="true">#</a> populateBean()：给Bean的属性赋值</h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">populateBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">RootBeanDefinition</span> mbd<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">BeanWrapper</span> bw<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
		<span class="token comment">// 从Bean定义里面把准备好的值都拿出来~~~</span>
		<span class="token comment">// 它是个MutablePropertyValues，持有N多个属性的值~~~</span>
		<span class="token class-name">PropertyValues</span> pvs <span class="token operator">=</span> <span class="token punctuation">(</span>mbd<span class="token punctuation">.</span><span class="token function">hasPropertyValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> mbd<span class="token punctuation">.</span><span class="token function">getPropertyValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">BeanPostProcessor</span> bp <span class="token operator">:</span> <span class="token function">getBeanPostProcessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
			<span class="token comment">// 此处会从后置处理，从里面把依赖的属性，值都拿到。比如大名鼎鼎的AutowiredAnnotationBeanPostProcessor就是在此处拿出值的~~~</span>
			<span class="token class-name">PropertyValues</span> pvsToUse <span class="token operator">=</span> ibp<span class="token punctuation">.</span><span class="token function">postProcessProperties</span><span class="token punctuation">(</span>pvs<span class="token punctuation">,</span> bw<span class="token punctuation">.</span><span class="token function">getWrappedInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
			pvs <span class="token operator">=</span> pvsToUse<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
		<span class="token comment">// 若存在属性pvs ，那就做赋值操作吧~~~（本处才是今天关心的重点~~~）</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pvs <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">applyPropertyValues</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> bw<span class="token punctuation">,</span> pvs<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 深入到方法内部，它完成了k-v值的准备工作，很多重要的<code>BeanPostProcessor</code>也在此处得到执行。对于最终给属性赋值的步骤，是交给了本类的<code>applyPropertyValues()</code>方法去完成</p><h5 id="applypropertyvalues-完成属性赋值" tabindex="-1"><a class="header-anchor" href="#applypropertyvalues-完成属性赋值" aria-hidden="true">#</a> applyPropertyValues：完成属性赋值</h5><p>这个方法的处理内容才是本文<strong>最应该关注的核心</strong>，它在处理数据解析、转换这一块还是存在不小的复杂度的~</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>	<span class="token comment">// 本方法传入了beanName和bean定义信息，以及它对应的BeanWrapper和value值们~</span>
	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">applyPropertyValues</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span> mbd<span class="token punctuation">,</span> <span class="token class-name">BeanWrapper</span> bw<span class="token punctuation">,</span> <span class="token class-name">PropertyValues</span> pvs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pvs<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
		<span class="token class-name">MutablePropertyValues</span> mpvs <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PropertyValue</span><span class="token punctuation">&gt;</span></span> original<span class="token punctuation">;</span>

		<span class="token comment">// 说明一下：为何这里还是要判断一下，虽然Spring对PropertyValues的内建实现只有MutablePropertyValues</span>
		<span class="token comment">// 但是这个是调用者自己也可以实现逻辑的~~~so判断一下最佳~~~~</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pvs <span class="token keyword">instanceof</span> <span class="token class-name">MutablePropertyValues</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			mpvs <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">MutablePropertyValues</span><span class="token punctuation">)</span> pvs<span class="token punctuation">;</span>
			<span class="token comment">// 此处有个短路处理：</span>
			<span class="token comment">// 若该mpvs中的所有属性值都已经转换为对应的类型，则把mpvs设置到BeanWrapper中，返回</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>mpvs<span class="token punctuation">.</span><span class="token function">isConverted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// Shortcut: use the pre-converted values as-is.</span>
				<span class="token keyword">try</span> <span class="token punctuation">{</span>
					bw<span class="token punctuation">.</span><span class="token function">setPropertyValues</span><span class="token punctuation">(</span>mpvs<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">return</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BeansException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanCreationException</span><span class="token punctuation">(</span>mbd<span class="token punctuation">.</span><span class="token function">getResourceDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> <span class="token string">&quot;Error setting property values&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 否则，拿到里面的属性值们~~~</span>
			original <span class="token operator">=</span> mpvs<span class="token punctuation">.</span><span class="token function">getPropertyValueList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			original <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>pvs<span class="token punctuation">.</span><span class="token function">getPropertyValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 显然，若调用者没有自定义转换器，那就使用BeanWrapper本身~~~（因为BeanWrapper实现了TypeConverter 接口~~）</span>
		<span class="token class-name">TypeConverter</span> converter <span class="token operator">=</span> <span class="token function">getCustomTypeConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>converter <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			converter <span class="token operator">=</span> bw<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		<span class="token comment">// 获取BeanDefinitionValueResolver，该Bean用于将bean定义对象中包含的值解析为应用于目标bean实例的实际值。</span>
		<span class="token class-name">BeanDefinitionValueResolver</span> valueResolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionValueResolver</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> converter<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// Create a deep copy, resolving any references for values.</span>
		<span class="token comment">// 此处翻译成深度拷贝不合适，倒不如翻译成深度解析更为合理~~~~</span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PropertyValue</span><span class="token punctuation">&gt;</span></span> deepCopy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>original<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">boolean</span> resolveNecessary <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

		<span class="token comment">// 遍历没有被解析的original属性值们~~~~</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">PropertyValue</span> pv <span class="token operator">:</span> original<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>pv<span class="token punctuation">.</span><span class="token function">isConverted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				deepCopy<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>pv<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 那种还没被解析过的PropertyValue此处会一步步解析~~~~</span>
				<span class="token class-name">String</span> propertyName <span class="token operator">=</span> pv<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 属性名称</span>
				<span class="token class-name">Object</span> originalValue <span class="token operator">=</span> pv<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 未经类型转换的值（注意：是未经转换的，可能还只是个字符串或者表达式而已~~~~）</span>

				<span class="token comment">// 最为复杂的解析逻辑~~~</span>
				<span class="token class-name">Object</span> resolvedValue <span class="token operator">=</span> valueResolver<span class="token punctuation">.</span><span class="token function">resolveValueIfNecessary</span><span class="token punctuation">(</span>pv<span class="token punctuation">,</span> originalValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token class-name">Object</span> convertedValue <span class="token operator">=</span> resolvedValue<span class="token punctuation">;</span>

				<span class="token comment">// 属性可写 并且 不是嵌套（如foo.bar，java中用getFoo().getBar()表示）或者索引（如person.addresses[0]）属性</span>
				<span class="token keyword">boolean</span> convertible <span class="token operator">=</span> bw<span class="token punctuation">.</span><span class="token function">isWritableProperty</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token class-name">PropertyAccessorUtils</span><span class="token punctuation">.</span><span class="token function">isNestedOrIndexedProperty</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>convertible<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token comment">// 用类型转换器进行转换</span>
					convertedValue <span class="token operator">=</span> <span class="token function">convertForProperty</span><span class="token punctuation">(</span>resolvedValue<span class="token punctuation">,</span> propertyName<span class="token punctuation">,</span> bw<span class="token punctuation">,</span> converter<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>resolvedValue <span class="token operator">==</span> originalValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>convertible<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						pv<span class="token punctuation">.</span><span class="token function">setConvertedValue</span><span class="token punctuation">(</span>convertedValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					deepCopy<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>pv<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>convertible <span class="token operator">&amp;&amp;</span> originalValue <span class="token keyword">instanceof</span> <span class="token class-name">TypedStringValue</span> <span class="token operator">&amp;&amp;</span>
						<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TypedStringValue</span><span class="token punctuation">)</span> originalValue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDynamic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
						<span class="token operator">!</span><span class="token punctuation">(</span>convertedValue <span class="token keyword">instanceof</span> <span class="token class-name">Collection</span> <span class="token operator">||</span> <span class="token class-name">ObjectUtils</span><span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>convertedValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					pv<span class="token punctuation">.</span><span class="token function">setConvertedValue</span><span class="token punctuation">(</span>convertedValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
					deepCopy<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>pv<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span> <span class="token punctuation">{</span>
					resolveNecessary <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
					deepCopy<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PropertyValue</span><span class="token punctuation">(</span>pv<span class="token punctuation">,</span> convertedValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 标记mpvs已经转换</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mpvs <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>resolveNecessary<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			mpvs<span class="token punctuation">.</span><span class="token function">setConverted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// Set our (possibly massaged) deep copy.</span>
		<span class="token comment">// 使用转换后的值进行填充~~~~~~~~~~</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			bw<span class="token punctuation">.</span><span class="token function">setPropertyValues</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MutablePropertyValues</span><span class="token punctuation">(</span>deepCopy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BeansException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanCreationException</span><span class="token punctuation">(</span>mbd<span class="token punctuation">.</span><span class="token function">getResourceDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> <span class="token string">&quot;Error setting property values&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	<span class="token punctuation">}</span>

	<span class="token comment">// 属性值的转换</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token keyword">private</span> <span class="token class-name">Object</span> <span class="token function">convertForProperty</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> value<span class="token punctuation">,</span> <span class="token class-name">String</span> propertyName<span class="token punctuation">,</span> <span class="token class-name">BeanWrapper</span> bw<span class="token punctuation">,</span> <span class="token class-name">TypeConverter</span> converter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 需要特别注意的是：convertForProperty方法是BeanWrapperImpl的实例方法，并非接口方法</span>
		<span class="token comment">// 这个方法内部就用到了CachedIntrospectionResults，从何就和Java内省搭上了关系~~~</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>converter <span class="token keyword">instanceof</span> <span class="token class-name">BeanWrapperImpl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">BeanWrapperImpl</span><span class="token punctuation">)</span> converter<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">convertForProperty</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> propertyName<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 自定义转换器</span>
			<span class="token class-name">PropertyDescriptor</span> pd <span class="token operator">=</span> bw<span class="token punctuation">.</span><span class="token function">getPropertyDescriptor</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">MethodParameter</span> methodParam <span class="token operator">=</span> <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">getWriteMethodParameter</span><span class="token punctuation">(</span>pd<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> converter<span class="token punctuation">.</span><span class="token function">convertIfNecessary</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> pd<span class="token punctuation">.</span><span class="token function">getPropertyType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> methodParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>applyPropertyValues()</code>这一步完成之后，就彻底完成了对Bean实例属性的赋值。从中可以看到最终的赋值操作，核心依赖的就是这么一句话：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>bw<span class="token punctuation">.</span><span class="token function">setPropertyValues</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MutablePropertyValues</span><span class="token punctuation">(</span>deepCopy<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>​ 并且从转换的逻辑我们也需要知道的是：IoC并不是100%得使用<code>BeanWrapper</code>的，若我们是自定义了一个转换器，其实是<strong>可以不经过Java内省机制</strong>，而是直接通过反射来实现的，当然并不建议这么去做。</p><p>​ <code>BeanWrapper</code>体系相比于 Spring 中其他体系是比较简单的，它作为<code>BeanDefinition</code>向 <code>Bean</code>转换过程中的<strong>中间产物</strong>，承载了 bean 实例的<strong>包装、类型转换、属性的设置</strong>以及<strong>访问</strong>等重要作用（请不要落了访问这个重要能力）。</p><hr><h3 id="databinder" tabindex="-1"><a class="header-anchor" href="#databinder" aria-hidden="true">#</a> DataBinder</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataBinder</span> <span class="token keyword">implements</span> <span class="token class-name">PropertyEditorRegistry</span><span class="token punctuation">,</span> <span class="token class-name">TypeConverter</span> <span class="token punctuation">{</span>

	<span class="token doc-comment comment">/** Default object name used for binding: &quot;target&quot;. */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEFAULT_OBJECT_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;target&quot;</span><span class="token punctuation">;</span>
	<span class="token doc-comment comment">/** Default limit for array and collection growing: 256. */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">DEFAULT_AUTO_GROW_COLLECTION_LIMIT</span> <span class="token operator">=</span> <span class="token number">256</span><span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Nullable</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> target<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> objectName<span class="token punctuation">;</span> <span class="token comment">// 默认值是target</span>

	<span class="token comment">// BindingResult：绑定错误、失败的时候会放进这里来~</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token keyword">private</span> <span class="token class-name">AbstractPropertyBindingResult</span> bindingResult<span class="token punctuation">;</span>

	<span class="token comment">//类型转换器，会注册最为常用的那么多类型转换Map&lt;Class&lt;?&gt;, PropertyEditor&gt; defaultEditors</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token keyword">private</span> <span class="token class-name">SimpleTypeConverter</span> typeConverter<span class="token punctuation">;</span>

	<span class="token comment">// 默认忽略不能识别的字段~</span>
	<span class="token keyword">private</span> <span class="token keyword">boolean</span> ignoreUnknownFields <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token comment">// 不能忽略非法的字段（比如我要Integer，你给传aaa，那肯定就不让绑定了，抛错）</span>
	<span class="token keyword">private</span> <span class="token keyword">boolean</span> ignoreInvalidFields <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token comment">// 默认是支持级联的~~~</span>
	<span class="token keyword">private</span> <span class="token keyword">boolean</span> autoGrowNestedPaths <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token keyword">int</span> autoGrowCollectionLimit <span class="token operator">=</span> <span class="token constant">DEFAULT_AUTO_GROW_COLLECTION_LIMIT</span><span class="token punctuation">;</span>

	<span class="token comment">// 这三个参数  都可以自己指定~~ 允许的字段、不允许的、必须的</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> allowedFields<span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> disallowedFields<span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> requiredFields<span class="token punctuation">;</span>

	<span class="token comment">// 转换器ConversionService</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token keyword">private</span> <span class="token class-name">ConversionService</span> conversionService<span class="token punctuation">;</span>
	<span class="token comment">// 状态码处理器~</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token keyword">private</span> <span class="token class-name">MessageCodesResolver</span> messageCodesResolver<span class="token punctuation">;</span>
	<span class="token comment">// 绑定出现错误的处理器~</span>
	<span class="token keyword">private</span> <span class="token class-name">BindingErrorProcessor</span> bindingErrorProcessor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultBindingErrorProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 校验器（这个非常重要）</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Validator</span><span class="token punctuation">&gt;</span></span> validators <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//  objectName没有指定，就用默认的</span>
	<span class="token keyword">public</span> <span class="token class-name">DataBinder</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token constant">DEFAULT_OBJECT_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token class-name">DataBinder</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> target<span class="token punctuation">,</span> <span class="token class-name">String</span> objectName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token class-name">ObjectUtils</span><span class="token punctuation">.</span><span class="token function">unwrapOptional</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>objectName <span class="token operator">=</span> objectName<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment">// 省略所有属性的get/set方法</span>

	<span class="token comment">// 提供一些列的初始化方法，供给子类使用 或者外部使用  下面两个初始化方法是互斥的</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initBeanPropertyAccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>bindingResult <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;DataBinder is already initialized - call initBeanPropertyAccess before other configuration methods&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>bindingResult <span class="token operator">=</span> <span class="token function">createBeanPropertyBindingResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">protected</span> <span class="token class-name">AbstractPropertyBindingResult</span> <span class="token function">createBeanPropertyBindingResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">BeanPropertyBindingResult</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BeanPropertyBindingResult</span><span class="token punctuation">(</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getObjectName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">isAutoGrowNestedPaths</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getAutoGrowCollectionLimit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>conversionService <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			result<span class="token punctuation">.</span><span class="token function">initConversion</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>conversionService<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>messageCodesResolver <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			result<span class="token punctuation">.</span><span class="token function">setMessageCodesResolver</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>messageCodesResolver<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> result<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 你会发现，初始化DirectFieldAccess的时候，校验的也是bindingResult ~~~~</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initDirectFieldAccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>bindingResult <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;DataBinder is already initialized - call initDirectFieldAccess before other configuration methods&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>bindingResult <span class="token operator">=</span> <span class="token function">createDirectFieldBindingResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">protected</span> <span class="token class-name">AbstractPropertyBindingResult</span> <span class="token function">createDirectFieldBindingResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">DirectFieldBindingResult</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DirectFieldBindingResult</span><span class="token punctuation">(</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getObjectName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">isAutoGrowNestedPaths</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>conversionService <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			result<span class="token punctuation">.</span><span class="token function">initConversion</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>conversionService<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>messageCodesResolver <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			result<span class="token punctuation">.</span><span class="token function">setMessageCodesResolver</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>messageCodesResolver<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> result<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token comment">// 把属性访问器返回，PropertyAccessor(默认直接从结果里拿)，子类MapDataBinder有复写</span>
	<span class="token keyword">protected</span> <span class="token class-name">ConfigurablePropertyAccessor</span> <span class="token function">getPropertyAccessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token function">getInternalBindingResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPropertyAccessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 可以看到简单的转换器也是使用到了conversionService的，可见conversionService它的效用</span>
	<span class="token keyword">protected</span> <span class="token class-name">SimpleTypeConverter</span> <span class="token function">getSimpleTypeConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>typeConverter <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>typeConverter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleTypeConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>conversionService <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>typeConverter<span class="token punctuation">.</span><span class="token function">setConversionService</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>conversionService<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>typeConverter<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment">// 省略众多get方法</span>
	
	<span class="token comment">// 设置指定的可以绑定的字段，默认是所有字段~~~</span>
	<span class="token comment">// 例如，在绑定HTTP请求参数时，限制这一点以避免恶意用户进行不必要的修改。</span>
	<span class="token comment">// 简单的说：我可以控制只有指定的一些属性才允许你修改~~~~</span>
	<span class="token comment">// 注意：它支持xxx*,*xxx,*xxx*这样的通配符  支持[]这样子来写~</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAllowedFields</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> allowedFields<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>allowedFields <span class="token operator">=</span> <span class="token class-name">PropertyAccessorUtils</span><span class="token punctuation">.</span><span class="token function">canonicalPropertyNames</span><span class="token punctuation">(</span>allowedFields<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDisallowedFields</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> disallowedFields<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>disallowedFields <span class="token operator">=</span> <span class="token class-name">PropertyAccessorUtils</span><span class="token punctuation">.</span><span class="token function">canonicalPropertyNames</span><span class="token punctuation">(</span>disallowedFields<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 注册每个绑定进程所必须的字段。</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setRequiredFields</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> requiredFields<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>requiredFields <span class="token operator">=</span> <span class="token class-name">PropertyAccessorUtils</span><span class="token punctuation">.</span><span class="token function">canonicalPropertyNames</span><span class="token punctuation">(</span>requiredFields<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;DataBinder requires binding of required fields [&quot;</span> <span class="token operator">+</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">arrayToCommaDelimitedString</span><span class="token punctuation">(</span>requiredFields<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token comment">// 注意：这个是set方法，后面是有add方法的~</span>
	<span class="token comment">// 注意：虽然是set，但是引用是木有变的~~~~</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setValidator</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Validator</span> validator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 判断逻辑在下面：你的validator至少得支持这种类型呀  哈哈</span>
		<span class="token function">assertValidators</span><span class="token punctuation">(</span>validator<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 因为自己手动设置了，所以先清空  再加进来~~~</span>
		<span class="token comment">// 这步你会发现，即使validator是null，也是会clear的哦~  符合语意</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>validators<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>validator <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>validators<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>validator<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">assertValidators</span><span class="token punctuation">(</span><span class="token class-name">Validator</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> validators<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Object</span> target <span class="token operator">=</span> <span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Validator</span> validator <span class="token operator">:</span> validators<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>validator <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>target <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>validator<span class="token punctuation">.</span><span class="token function">supports</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;Invalid target for Validator [&quot;</span> <span class="token operator">+</span> validator <span class="token operator">+</span> <span class="token string">&quot;]: &quot;</span> <span class="token operator">+</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addValidators</span><span class="token punctuation">(</span><span class="token class-name">Validator</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> validators<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">assertValidators</span><span class="token punctuation">(</span>validators<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>validators<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>validators<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 效果同set</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">replaceValidators</span><span class="token punctuation">(</span><span class="token class-name">Validator</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> validators<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">assertValidators</span><span class="token punctuation">(</span>validators<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>validators<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>validators<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>validators<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">// 返回一个，也就是primary默认的校验器</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token keyword">public</span> <span class="token class-name">Validator</span> <span class="token function">getValidator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>validators<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>validators<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 只读视图</span>
	<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Validator</span><span class="token punctuation">&gt;</span></span> <span class="token function">getValidators</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">unmodifiableList</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>validators<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// since Spring 3.0</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setConversionService</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ConversionService</span> conversionService<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>conversionService <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;DataBinder is already initialized with ConversionService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>conversionService <span class="token operator">=</span> conversionService<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>bindingResult <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> conversionService <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>bindingResult<span class="token punctuation">.</span><span class="token function">initConversion</span><span class="token punctuation">(</span>conversionService<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// =============下面它提供了非常多的addCustomFormatter()方法  注册进PropertyEditorRegistry里=====================</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addCustomFormatter</span><span class="token punctuation">(</span><span class="token class-name">Formatter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> formatter<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addCustomFormatter</span><span class="token punctuation">(</span><span class="token class-name">Formatter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> formatter<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> fields<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addCustomFormatter</span><span class="token punctuation">(</span><span class="token class-name">Formatter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> formatter<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> fieldTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 实现接口方法</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerCustomEditor</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> requiredType<span class="token punctuation">,</span> <span class="token class-name">PropertyEditor</span> propertyEditor<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerCustomEditor</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> requiredType<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> field<span class="token punctuation">,</span> <span class="token class-name">PropertyEditor</span> propertyEditor<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token comment">// 实现接口方法</span>
	<span class="token comment">// 统一委托给持有的TypeConverter~~或者是getInternalBindingResult().getPropertyAccessor();这里面的</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">convertIfNecessary</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> value<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> requiredType<span class="token punctuation">,</span>
			<span class="token annotation punctuation">@Nullable</span> <span class="token class-name">MethodParameter</span> methodParam<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">TypeMismatchException</span> <span class="token punctuation">{</span>

		<span class="token keyword">return</span> <span class="token function">getTypeConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">convertIfNecessary</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> requiredType<span class="token punctuation">,</span> methodParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>


	<span class="token comment">// ===========上面的方法都是开胃小菜，下面才是本类最重要的方法==============</span>

	<span class="token comment">// 该方法就是把提供的属性值们，绑定到目标对象target里去~~~</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token class-name">PropertyValues</span> pvs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">MutablePropertyValues</span> mpvs <span class="token operator">=</span> <span class="token punctuation">(</span>pvs <span class="token keyword">instanceof</span> <span class="token class-name">MutablePropertyValues</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token class-name">MutablePropertyValues</span><span class="token punctuation">)</span> pvs <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">MutablePropertyValues</span><span class="token punctuation">(</span>pvs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">doBind</span><span class="token punctuation">(</span>mpvs<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 此方法是protected的，子类WebDataBinder有复写~~~加强了一下</span>
	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doBind</span><span class="token punctuation">(</span><span class="token class-name">MutablePropertyValues</span> mpvs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 前面两个check就不解释了，重点看看applyPropertyValues(mpvs)这个方法~</span>
		<span class="token function">checkAllowedFields</span><span class="token punctuation">(</span>mpvs<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">checkRequiredFields</span><span class="token punctuation">(</span>mpvs<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">applyPropertyValues</span><span class="token punctuation">(</span>mpvs<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// allowe允许的 并且还是没有在disallowed里面的 这个字段就是被允许的</span>
	<span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">isAllowed</span><span class="token punctuation">(</span><span class="token class-name">String</span> field<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> allowed <span class="token operator">=</span> <span class="token function">getAllowedFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> disallowed <span class="token operator">=</span> <span class="token function">getDisallowedFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ObjectUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>allowed<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">PatternMatchUtils</span><span class="token punctuation">.</span><span class="token function">simpleMatch</span><span class="token punctuation">(</span>allowed<span class="token punctuation">,</span> field<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
				<span class="token punctuation">(</span><span class="token class-name">ObjectUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>disallowed<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token class-name">PatternMatchUtils</span><span class="token punctuation">.</span><span class="token function">simpleMatch</span><span class="token punctuation">(</span>disallowed<span class="token punctuation">,</span> field<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token comment">// protected 方法，给target赋值~~~~</span>
	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">applyPropertyValues</span><span class="token punctuation">(</span><span class="token class-name">MutablePropertyValues</span> mpvs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token comment">// 可以看到最终赋值 是委托给PropertyAccessor去完成的</span>
			<span class="token function">getPropertyAccessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPropertyValues</span><span class="token punctuation">(</span>mpvs<span class="token punctuation">,</span> <span class="token function">isIgnoreUnknownFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">isIgnoreInvalidFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// 抛出异常，交给BindingErrorProcessor一个个处理~~~</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">PropertyBatchUpdateException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">PropertyAccessException</span> pae <span class="token operator">:</span> ex<span class="token punctuation">.</span><span class="token function">getPropertyAccessExceptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">getBindingErrorProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">processPropertyAccessException</span><span class="token punctuation">(</span>pae<span class="token punctuation">,</span> <span class="token function">getInternalBindingResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 执行校验，此处就和BindingResult 关联上了，校验失败的消息都会放进去（不是直接抛出异常哦~ ）</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Object</span> target <span class="token operator">=</span> <span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span>target <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;No target to validate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">BindingResult</span> bindingResult <span class="token operator">=</span> <span class="token function">getBindingResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 每个Validator都会执行~~~~</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Validator</span> validator <span class="token operator">:</span> <span class="token function">getValidators</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			validator<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> bindingResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 带有校验提示的校验器。SmartValidator</span>
	<span class="token comment">// @since 3.1</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">validate</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> validationHints<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

	<span class="token comment">// 这一步也挺有意思：实际上就是若有错误，就抛出异常</span>
	<span class="token comment">// 若没错误  就把绑定的Model返回~~~(可以看到BindingResult里也能拿到最终值哦~~~)</span>
	<span class="token comment">// 此方法可以调用，但一般较少使用~</span>
	<span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BindException</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getBindingResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BindException</span><span class="token punctuation">(</span><span class="token function">getBindingResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token function">getBindingResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 它是个<strong>实现类</strong>，直接实现了<code>PropertyEditorRegistry</code>和<code>TypeConverter</code>这两个接口，因此它可以注册<code>java.beans.PropertyEditor</code>，并且能完成类型转换（<code>TypeConverter</code>）。</p><p>它提供了如下能力：</p><ol><li>把属性值<code>PropertyValues</code>绑定到target上（<code>bind()</code>方法，依赖于<code>PropertyAccessor</code>实现~）</li><li>提供校验的能力：提供了public方法<code>validate()</code>对各个属性使用<code>Validator</code>执行校验~</li><li>提供了注册属性编辑器（<code>PropertyEditor</code>）和对类型进行转换的能力（<code>TypeConverter</code>）</li></ol><p>还需要注意的是：</p><ol><li><code>initBeanPropertyAccess</code>和<code>initDirectFieldAccess</code>两个初始化<code>PropertyAccessor</code>方法是互斥的 <ul><li><code>initBeanPropertyAccess()</code>创建的是<code>BeanPropertyBindingResult</code>，内部依赖<code>BeanWrapper</code></li><li><code>initDirectFieldAccess</code>创建的是<code>DirectFieldBindingResult</code>，内部依赖<code>DirectFieldAccessor</code></li></ul></li><li>这两个方法内部没有显示的调用，但是Spring内部<strong>默认</strong>使用的是<code>initBeanPropertyAccess()</code>，具体可以参照<code>getInternalBindingResult()</code>方法~</li></ol><hr><h4 id="webdatabinder" tabindex="-1"><a class="header-anchor" href="#webdatabinder" aria-hidden="true">#</a> WebDataBinder</h4><hr><h2 id="数据校验" tabindex="-1"><a class="header-anchor" href="#数据校验" aria-hidden="true">#</a> 数据校验</h2><h3 id="常用注解" tabindex="-1"><a class="header-anchor" href="#常用注解" aria-hidden="true">#</a> 常用注解</h3><h4 id="jsr303" tabindex="-1"><a class="header-anchor" href="#jsr303" aria-hidden="true">#</a> JSR303</h4><table><thead><tr><th style="text-align:left;">注解</th><th style="text-align:left;">支持类型</th><th style="text-align:left;">含义</th><th style="text-align:left;">null值是否校验</th></tr></thead><tbody><tr><td style="text-align:left;">@AssertFalse</td><td style="text-align:left;">bool</td><td style="text-align:left;">元素必须是false</td><td style="text-align:left;">否</td></tr><tr><td style="text-align:left;">@AssertTrue</td><td style="text-align:left;">bool</td><td style="text-align:left;">元素必须是true</td><td style="text-align:left;">否</td></tr><tr><td style="text-align:left;">@DecimalMax</td><td style="text-align:left;">Number的子类型（浮点数除外）以及String</td><td style="text-align:left;">元素必须是一个数字，且值必须&lt;=最大值</td><td style="text-align:left;">否</td></tr><tr><td style="text-align:left;">@DecimalMin</td><td style="text-align:left;">同上</td><td style="text-align:left;">元素必须是一个数字，且值必须&gt;=最大值</td><td style="text-align:left;">否</td></tr><tr><td style="text-align:left;">@Max</td><td style="text-align:left;">同上</td><td style="text-align:left;">同上</td><td style="text-align:left;">否</td></tr><tr><td style="text-align:left;">@Min</td><td style="text-align:left;">同上</td><td style="text-align:left;">同上</td><td style="text-align:left;">否</td></tr><tr><td style="text-align:left;">@Digits</td><td style="text-align:left;">同上</td><td style="text-align:left;">元素构成是否合法（整数部分和小数部分）</td><td style="text-align:left;">否</td></tr><tr><td style="text-align:left;">@Future</td><td style="text-align:left;">时间类型(包括JSR310)</td><td style="text-align:left;">元素必须为一个将来（不包含相等）的日期(比较精确到毫秒)</td><td style="text-align:left;">否</td></tr><tr><td style="text-align:left;">@Past</td><td style="text-align:left;">同上</td><td style="text-align:left;">元素必须为一个过去（不包含相等）的日期(比较精确到毫秒)</td><td style="text-align:left;">否</td></tr><tr><td style="text-align:left;">@NotNull</td><td style="text-align:left;">any</td><td style="text-align:left;">元素不能为null</td><td style="text-align:left;">是</td></tr><tr><td style="text-align:left;">@Null</td><td style="text-align:left;">any</td><td style="text-align:left;">元素必须为null</td><td style="text-align:left;">是</td></tr><tr><td style="text-align:left;">@Pattern</td><td style="text-align:left;">字符串</td><td style="text-align:left;">元素需符合指定的正则表达式</td><td style="text-align:left;">否</td></tr><tr><td style="text-align:left;">@Size</td><td style="text-align:left;">String/Collection/Map/Array</td><td style="text-align:left;">元素大小需在指定范围中</td><td style="text-align:left;">否</td></tr></tbody></table><h4 id="jsr380" tabindex="-1"><a class="header-anchor" href="#jsr380" aria-hidden="true">#</a> JSR380</h4><table><thead><tr><th style="text-align:left;">注解</th><th style="text-align:left;">支持类型</th><th style="text-align:left;">含义</th><th style="text-align:left;">null值是否校验</th></tr></thead><tbody><tr><td style="text-align:left;">@Email</td><td style="text-align:left;">字符串</td><td style="text-align:left;">元素必须为电子邮箱地址</td><td style="text-align:left;">否</td></tr><tr><td style="text-align:left;">@NotEmpty</td><td style="text-align:left;">容器类型</td><td style="text-align:left;">集合的Size必须大于0</td><td style="text-align:left;">是</td></tr><tr><td style="text-align:left;">@NotBlank</td><td style="text-align:left;">字符串</td><td style="text-align:left;">字符串必须包含至少一个非空白的字符</td><td style="text-align:left;">是</td></tr><tr><td style="text-align:left;">@Positive</td><td style="text-align:left;">数字类型</td><td style="text-align:left;">元素必须为正数（不包括0）</td><td style="text-align:left;">否</td></tr><tr><td style="text-align:left;">@PositiveOrZero</td><td style="text-align:left;">同上</td><td style="text-align:left;">同上（包括0）</td><td style="text-align:left;">否</td></tr><tr><td style="text-align:left;">@Negative</td><td style="text-align:left;">同上</td><td style="text-align:left;">元素必须为负数（不包括0）</td><td style="text-align:left;">否</td></tr><tr><td style="text-align:left;">@NegativeOrZero</td><td style="text-align:left;">同上</td><td style="text-align:left;">同上（包括0）</td><td style="text-align:left;">否</td></tr><tr><td style="text-align:left;">@PastOrPresent</td><td style="text-align:left;">时间类型</td><td style="text-align:left;">在@Past基础上包括相等</td><td style="text-align:left;">否</td></tr><tr><td style="text-align:left;">@FutureOrPresent</td><td style="text-align:left;">时间类型</td><td style="text-align:left;">在@Futrue基础上包括相等</td><td style="text-align:left;">否</td></tr></tbody></table><h4 id="hibernate" tabindex="-1"><a class="header-anchor" href="#hibernate" aria-hidden="true">#</a> Hibernate</h4><table><thead><tr><th style="text-align:left;">约束注解</th><th style="text-align:left;">支持的类型</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">@URL</td><td style="text-align:left;">CharSequence</td><td style="text-align:left;">校验URL。protocol=&quot;&quot;,host=&quot;&quot;, port=&quot;&quot;, regexp=&quot;.*&quot;, flags={}</td></tr><tr><td style="text-align:left;">@UniqueElements</td><td style="text-align:left;">Collection</td><td style="text-align:left;">集合内不允许有重复元素。</td></tr><tr><td style="text-align:left;">@SafeHtml</td><td style="text-align:left;">CharSequence</td><td style="text-align:left;">传入的文本中不能含有script等敏感标签。（注意：需要org.jsoup包的支持）</td></tr><tr><td style="text-align:left;">@Range</td><td style="text-align:left;">同@Min</td><td style="text-align:left;">是对@Min和@Max的结合补充</td></tr><tr><td style="text-align:left;">@Length</td><td style="text-align:left;">CharSequence</td><td style="text-align:left;">value.length() &gt;= min &amp;&amp; value.length() &lt;= max（null is valid）</td></tr><tr><td style="text-align:left;">@ISBN</td><td style="text-align:left;">CharSequence</td><td style="text-align:left;">校验图书的ISBN。type：Type.ISBN_13（还有个取值：ISBN_10）</td></tr><tr><td style="text-align:left;">@EAN</td><td style="text-align:left;">CharSequence</td><td style="text-align:left;">校验商用条形码EAN</td></tr><tr><td style="text-align:left;">@Currency</td><td style="text-align:left;">MonetaryAmount</td><td style="text-align:left;">校验货币。value：只允许的货币种类，如USD, EUR等</td></tr><tr><td style="text-align:left;">@CodePointLength</td><td style="text-align:left;">CharSequence</td><td style="text-align:left;">校验代码点codePoint。关于String的length和代码点，可参考这里 一般不使用，使用@Length即可~</td></tr><tr><td style="text-align:left;">@ConstraintComposition</td><td style="text-align:left;">all</td><td style="text-align:left;">所有约束是AND/OR/ALL_FALSE关系。它只能标注在注解上，运用于组合注解上</td></tr><tr><td style="text-align:left;">@DurationMax</td><td style="text-align:left;">Duration</td><td style="text-align:left;">maxDuration.compareTo( value )这么比较的，相等也是valid的</td></tr><tr><td style="text-align:left;">@DurationMin</td><td style="text-align:left;">Duration</td><td style="text-align:left;">`minDuration.compareTo( value )这么比较的，相等也是valid的</td></tr><tr><td style="text-align:left;">@CNPJ</td><td style="text-align:left;">CharSequence</td><td style="text-align:left;">法人国家登记号</td></tr><tr><td style="text-align:left;">@ReportAsSingleViolation</td><td style="text-align:left;">*</td><td style="text-align:left;">如果<code>@NotEmpty</code>、<code>@Pattern</code>都校验失败，不添加此注解，则会生成<strong>两个</strong>校验失败的结果。若添加了此注解，那错误消息以它标注的本注解的<code>message</code>为准</td></tr></tbody></table><h3 id="validated和-valid的区别" tabindex="-1"><a class="header-anchor" href="#validated和-valid的区别" aria-hidden="true">#</a> @Validated和@Valid的区别</h3><ol><li><code>@Valid</code>：标准JSR-303规范的标记型注解，用来标记验证属性和方法返回值，进行<strong>级联和递归校验</strong></li><li><code>@Validated</code>：<code>Spring</code>的注解，是标准<code>JSR-303</code>的一个变种（补充），提供了一个<strong>分组</strong>功能，可以在入参验证时，根据不同的分组采用不同的验证机制</li><li>在<code>Controller</code>中校验方法参数时，使用@Valid和@Validated并无特殊差异（若不需要分组校验的话）</li><li><code>@Validated</code>注解可以用于类级别，用于支持Spring进行方法级别的参数校验。<code>@Valid</code>可以用在属性级别约束，用来表示<strong>级联校验</strong>。</li><li><code>@Validated</code>只能用在类、方法和参数上，而<code>@Valid</code>可用于方法、<strong>字段、构造器</strong>和参数上</li></ol><h3 id="分组校验" tabindex="-1"><a class="header-anchor" href="#分组校验" aria-hidden="true">#</a> 分组校验</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 该接口定义了：动态Group序列的协定</span>
<span class="token comment">// 要想它生效，需要在T上标注@GroupSequenceProvider注解并且指定此类为处理类</span>
<span class="token comment">// 如果`Default`组对T进行验证，则实际验证的实例将传递给此类以确定默认组序列（这句话特别重要  下面用例子解释）</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DefaultGroupSequenceProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
	<span class="token comment">// 合格方法是给T返回默认的组（多个）。因为默认的组是Default嘛~~~通过它可以自定指定</span>
	<span class="token comment">// 入参T object允许在验证值状态的函数中动态组合默认组序列。（非常强大）</span>
	<span class="token comment">// object是待校验的Bean。它可以为null哦~（Validator#validateValue的时候可以为null）</span>

	<span class="token comment">// 返回值表示默认组序列的List。它的效果同@GroupSequence定义组序列，尤其是列表List必须包含类型T</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getValidationGroups</span><span class="token punctuation">(</span><span class="token class-name">T</span> object<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>示例如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@GroupSequenceProvider</span><span class="token punctuation">(</span><span class="token class-name">PersonGroupSequenceProvider</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Getter</span>
<span class="token annotation punctuation">@Setter</span>
<span class="token annotation punctuation">@ToString</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@NotNull</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@NotNull</span>
    <span class="token annotation punctuation">@Range</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@NotNull</span><span class="token punctuation">(</span>groups <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">WhenAge20And30Group</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">WhenAge30And40Group</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Size</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> groups <span class="token operator">=</span> <span class="token class-name">WhenAge20And30Group</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Size</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> groups <span class="token operator">=</span> <span class="token class-name">WhenAge30And40Group</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> hobbies<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 定义专属的业务逻辑分组
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">WhenAge20And30Group</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">WhenAge30And40Group</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PersonGroupSequenceProvider</span> <span class="token keyword">implements</span> <span class="token class-name">DefaultGroupSequenceProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getValidationGroups</span><span class="token punctuation">(</span><span class="token class-name">Person</span> bean<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> defaultGroupSequence <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        defaultGroupSequence<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这一步不能省,否则Default分组都不会执行了，会抛错的</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 这块判空请务必要做</span>
            <span class="token class-name">Integer</span> age <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;年龄为：&quot;</span> <span class="token operator">+</span> age <span class="token operator">+</span> <span class="token string">&quot;，执行对应校验逻辑&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>age <span class="token operator">&gt;=</span> <span class="token number">20</span> <span class="token operator">&amp;&amp;</span> age <span class="token operator">&lt;</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                defaultGroupSequence<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Person<span class="token punctuation">.</span>WhenAge20And30Group</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>age <span class="token operator">&gt;=</span> <span class="token number">30</span> <span class="token operator">&amp;&amp;</span> age <span class="token operator">&lt;</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                defaultGroupSequence<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Person<span class="token punctuation">.</span>WhenAge30And40Group</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> defaultGroupSequence<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>  <span class="token punctuation">{</span>
    <span class="token class-name">Person</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    person<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;fsx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    person<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		person<span class="token punctuation">.</span><span class="token function">setHobbies</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;足球&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;篮球&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConstraintViolation</span><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token class-name">Validation</span><span class="token punctuation">.</span><span class="token function">buildDefaultValidatorFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValidator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 对结果进行遍历输出</span>
    result<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>v <span class="token operator">-&gt;</span> v<span class="token punctuation">.</span><span class="token function">getPropertyPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> v<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">+</span> v<span class="token punctuation">.</span><span class="token function">getInvalidValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="spel" tabindex="-1"><a class="header-anchor" href="#spel" aria-hidden="true">#</a> SpEL</h2><ul><li><p>SpEL 字面量</p><ul><li>整数：<code>#{8} </code></li><li>小数：<code>#{8.8} </code></li><li>科学计数法：<code>#{1e4} </code></li><li>String：可以使用单引号或者双引号作为字符串的定界符号。</li><li>Boolean：<code>#{true}</code></li></ul></li><li><p>SpEL引用bean , 属性和方法</p><ul><li>引用其他对象: <code>#{car}</code></li><li>引用其他对象的属性：<code>#{car.brand} </code></li><li>调用其它方法 , 还可以链式操作：<code>#{car.toString()}</code></li><li>调用静态方法静态属性：<code>#{T(java.lang.Math).PI}</code></li></ul></li><li><p>SpEL支持的运算符号</p><ul><li>算术运算符：+，-，*，/，%，^(加号还可以用作字符串连接)</li><li>比较运算符：&lt; , &gt; , == , &gt;= , &lt;= , lt , gt , eg , le , ge</li><li>逻辑运算符：and , or , not , | - if-else 运算符(类似三目运算符)：<code>?:(temary)</code>, <code>?:(Elvis)</code></li><li>正则表达式：<code>#{admin.email matches &#39;[a-zA-Z0-9._%±]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}&#39;}</code></li></ul></li><li><p>SpEL解析方法</p><ul><li>方法参数，<code>#userId</code>，参数名<code>userId</code>的参数的值</li><li>返回值，<code>#$</code>或者<code>#result</code></li></ul></li><li><p>SpEL内置对象</p><ul><li><code>#this</code>：当前对象，如果在遍历列表，可能会改变为具体的每个元素对象</li><li><code>#root</code>：根对象，不会因为当前元素转变而转变</li></ul></li></ul></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/nocetfy/edit/main/docs/interview/框架/Spring 杂项.md" rel="noopener noreferrer" target="_blank" aria-label="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><!----><!----></div></footer><nav class="page-nav"><a href="/MyNotes/interview/%E6%A1%86%E6%9E%B6/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%B1%BB.html" class="nav-link prev" aria-label="常用工具类"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><!---->常用工具类</div></a><!----></nav><!----><!----><!--]--></main><!--]--><!----></div><!--]--><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/MyNotes/assets/app-59c87434.js" defer></script>
    <script src="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-y/instant.page/5.1.0/instantpage.min.js" type="application/javascript"></script>
  </body>
</html>
